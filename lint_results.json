[{"filePath":"/home/mathu/projects/markets/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/jest.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/next.config.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":4,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":4,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/prisma/seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/admin/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/admin/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/advisor/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/advisor/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/analytics/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/analytics/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/announcements/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/assets/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/audit/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/stats/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/users/[id]/status/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/admin/users/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/ai/advisor/advisor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/ai/advisor/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/ai/chat/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/analytics/journal/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/analytics/performance/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextRequest' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"NextRequest"},"fix":{"range":[10,22],"text":""},"desc":"Remove unused variable \"NextRequest\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/auth';\nimport { prisma } from '@/lib/db/prisma';\nimport { calculatePerformanceMetrics, Trade } from '@/lib/trading/analytics';\nimport { alpacaBroker } from '@/lib/brokers/alpaca';\n\nexport async function GET() {\n    try {\n        const session = await auth();\n\n        if (!session?.user?.id) {\n            return new NextResponse('Unauthorized', { status: 401 });\n        }\n\n        const userId = session.user.id;\n\n        // Fetch closed trades\n        const trades = await prisma.trade.findMany({\n            where: {\n                userId,\n                status: 'CLOSED',\n                exitTime: { not: null },\n                pnl: { not: null }\n            },\n            orderBy: {\n                exitTime: 'asc'\n            }\n        });\n\n        // Map Prisma trades to Analytics Trade interface\n        const analyticsTrades: Trade[] = trades.map(t => ({\n            id: t.id,\n            symbol: t.symbol,\n            side: t.side as 'LONG' | 'SHORT',\n            qty: t.qty,\n            entryPrice: t.entryPrice,\n            exitPrice: t.exitPrice!,\n            entryTime: t.entryTime,\n            exitTime: t.exitTime!,\n            pnl: t.pnl!,\n            exitReason: t.exitReason || undefined\n        }));\n\n        // Fetch current account equity\n        // Ideally we get this from the broker or maintain a local ledger. \n        // For now, let's try to fetch from Alpaca if credentials exist, otherwise calculate from initial + pnl.\n        let currentEquity = 100000; // Default fallback\n        let initialEquity = 100000; // Default fallback\n\n        try {\n            const account = await alpacaBroker.getAccount();\n            if (account) {\n                currentEquity = parseFloat(account.equity);\n                // Initial equity is hard to know without history, but we can approximate:\n                // Current - Total PnL = Initial (roughly, ignoring deposits/withdrawals)\n                const totalPnL = analyticsTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);\n                initialEquity = currentEquity - totalPnL;\n            }\n        } catch {\n            // console.warn('Failed to fetch Alpaca account for analytics', error);\n            // Fallback: Start with 100k and add PnL\n            const totalPnL = analyticsTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);\n            currentEquity = initialEquity + totalPnL;\n        }\n\n        const metrics = calculatePerformanceMetrics(\n            analyticsTrades,\n            initialEquity,\n            currentEquity\n        );\n\n        return NextResponse.json(metrics);\n\n    } catch (error) {\n        console.error('Performance API Error:', error);\n        return new NextResponse('Internal Server Error', { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/announcements/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/auth/2fa/check/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/auth/2fa/setup/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/auth/2fa/verify/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/auth/[...nextauth]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/auth/register/route.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is assigned a value but never used.","line":71,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/bank-accounts/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/budgets/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/budgets/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/export/audit/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/export/trades/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/financial-health/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/geo/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/goals/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/goals/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/market-data/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/notifications/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/stripe/checkout/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/stripe/portal/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/stripe/webhook/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/account/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextRequest' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"NextRequest"},"fix":{"range":[9,21],"text":""},"desc":"Remove unused variable \"NextRequest\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getUserServices } from '@/lib/auth/credentials';\nimport { requireAuth, apiError, apiSuccess } from '@/lib/api-helpers';\nimport { getRedisClient } from '@/lib/redis';\n\n/**\n * GET /api/trading/account\n * Fetch account information including cash, buying power, and portfolio value\n */\nexport async function GET() {\n    try {\n        // Require authentication\n        const authResult = await requireAuth();\n        if (authResult instanceof NextResponse) return authResult;\n\n        const { alpaca } = await getUserServices();\n        const redis = getRedisClient();\n        const cacheKey = `trading:account:${authResult.userId}`;\n\n        // Try to get from cache first (30 second TTL)\n        if (redis) {\n            try {\n                const cached = await redis.get(cacheKey);\n                if (cached) {\n                    if (cached) {\n                        const account = JSON.parse(cached);\n                        return apiSuccess({ account, cached: true });\n                    }\n                }\n            } catch {\n                // Redis failure should not block the request\n            }\n        }\n\n        // Fetch from Alpaca\n        const account = await alpaca.getAccount();\n\n        // Cache the result\n        if (redis) {\n            try {\n                await redis.setex(cacheKey, 30, JSON.stringify(account));\n            } catch {\n                // Redis failure should not block the request\n            }\n        }\n\n        return apiSuccess({ account });\n    } catch (error: unknown) {\n        console.error('Error fetching account:', error);\n        const errorMessage = error instanceof Error ? error.message : 'Failed to fetch account information';\n        return apiError(errorMessage);\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/analytics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/bracket/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/orders/[orderId]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/orders/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/positions/[...symbol]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/positions/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextRequest' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"NextRequest"},"fix":{"range":[9,21],"text":""},"desc":"Remove unused variable \"NextRequest\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getUserServices } from '@/lib/auth/credentials';\nimport { requireAuth, apiSuccess } from '@/lib/api-helpers';\n\n/**\n * GET /api/trading/positions\n * Fetch all open positions\n */\nexport async function GET() {\n    try {\n        const authResult = await requireAuth();\n        if (authResult instanceof NextResponse) return authResult;\n\n        const { alpaca } = await getUserServices();\n        const positions = await alpaca.getPositions();\n\n        return apiSuccess({ positions });\n    } catch (error: unknown) {\n        console.error('Error fetching positions:', error);\n        const errorMessage = error instanceof Error ? error.message : 'Failed to fetch positions';\n        return NextResponse.json(\n            {\n                success: false,\n                error: errorMessage,\n            },\n            { status: 500 }\n        );\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/recent/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/risk/calculate/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/trading/trailing-stop/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/transactions/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/transactions/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/user/credentials/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":57,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'credentials' is assigned a value but never used.","line":127,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/auth';\nimport { prisma } from '@/lib/db/prisma';\nimport { encrypt, decrypt, EncryptionError } from '@/lib/encryption';\nimport { z } from 'zod';\nimport logger from '@/lib/logger';\n\nconst credentialsSchema = z.object({\n    alpacaKeyId: z.string().optional(),\n    alpacaSecret: z.string().optional(),\n    fmpApiKey: z.string().optional(),\n    finnhubApiKey: z.string().optional(),\n    eodhdApiKey: z.string().optional(),\n    ipinfoToken: z.string().optional(),\n    googleApiKey: z.string().optional(),\n});\n\ninterface UpdateData {\n    alpacaKeyId?: string;\n    alpacaSecret?: string;\n    fmpApiKey?: string;\n    finnhubApiKey?: string;\n    eodhdApiKey?: string;\n    ipinfoToken?: string;\n    googleApiKey?: string;\n}\n\n/**\n * Mask a secret key for safe display.\n * Shows only the last 4 characters, rest replaced with asterisks.\n * e.g., \"PKABCDEFGH123456\" → \"************3456\"\n */\nfunction maskKey(key: string): string {\n    if (!key || key.length <= 4) return key ? '****' : '';\n    return '*'.repeat(key.length - 4) + key.slice(-4);\n}\n\n/**\n * Safely decrypt a credential field. Returns the decrypted value or null on failure.\n * Logs the error for observability without silently swallowing it.\n */\nasync function safeDecrypt(value: string | null | undefined, fieldName: string): Promise<string> {\n    if (!value) return '';\n    try {\n        return await decrypt(value);\n    } catch (error) {\n        if (error instanceof EncryptionError) {\n            logger.error(`Failed to decrypt ${fieldName}`, { error: error.message });\n        } else {\n            logger.error(`Unexpected error decrypting ${fieldName}`, { error });\n        }\n        // Return empty string but LOG the failure — callers see \"no credential\" but we have visibility\n        return '';\n    }\n}\n\nexport async function GET(req: Request) {\n    const session = await auth();\n\n    if (!session || !session.user) {\n        return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\n    }\n\n    try {\n        const credentials = await prisma.userCredentials.findUnique({\n            where: { userId: session.user.id },\n        });\n\n        if (!credentials) {\n            return NextResponse.json({});\n        }\n\n        // Decrypt keys in parallel for efficiency\n        const [alpacaKeyId, fmpApiKey, finnhubApiKey, eodhdApiKey, ipinfoToken, googleApiKey] = await Promise.all([\n            safeDecrypt(credentials.alpacaKeyId, 'alpacaKeyId'),\n            safeDecrypt(credentials.fmpApiKey, 'fmpApiKey'),\n            safeDecrypt(credentials.finnhubApiKey, 'finnhubApiKey'),\n            safeDecrypt(credentials.eodhdApiKey, 'eodhdApiKey'),\n            safeDecrypt(credentials.ipinfoToken, 'ipinfoToken'),\n            safeDecrypt(credentials.googleApiKey, 'googleApiKey'),\n        ]);\n\n        // Return MASKED keys — never send full secrets over HTTP\n        return NextResponse.json({\n            alpacaKeyId: maskKey(alpacaKeyId),\n            hasAlpacaSecret: !!credentials.alpacaSecret,\n            fmpApiKey: maskKey(fmpApiKey),\n            finnhubApiKey: maskKey(finnhubApiKey),\n            eodhdApiKey: maskKey(eodhdApiKey),\n            ipinfoToken: maskKey(ipinfoToken),\n            googleApiKey: maskKey(googleApiKey),\n        });\n    } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n        logger.error('Error fetching credentials', { error: errorMessage });\n        return NextResponse.json({ message: 'Internal Server Error' }, { status: 500 });\n    }\n}\n\nexport async function POST(req: Request) {\n    const session = await auth();\n\n    if (!session || !session.user) {\n        return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\n    }\n\n    try {\n        const body = await req.json();\n        const result = credentialsSchema.safeParse(body);\n\n        if (!result.success) {\n            return NextResponse.json({ message: 'Invalid input', errors: result.error.issues }, { status: 400 });\n        }\n\n        const { alpacaKeyId, alpacaSecret, fmpApiKey, finnhubApiKey, eodhdApiKey, ipinfoToken, googleApiKey } = result.data;\n\n        // Encrypt values\n        const updateData: UpdateData = {};\n        if (alpacaKeyId) updateData.alpacaKeyId = await encrypt(alpacaKeyId);\n        if (alpacaSecret) updateData.alpacaSecret = await encrypt(alpacaSecret);\n        if (fmpApiKey) updateData.fmpApiKey = await encrypt(fmpApiKey);\n        if (finnhubApiKey) updateData.finnhubApiKey = await encrypt(finnhubApiKey);\n        if (eodhdApiKey) updateData.eodhdApiKey = await encrypt(eodhdApiKey);\n        if (ipinfoToken) updateData.ipinfoToken = await encrypt(ipinfoToken);\n        if (googleApiKey) updateData.googleApiKey = await encrypt(googleApiKey);\n\n        const credentials = await prisma.userCredentials.upsert({\n            where: { userId: session.user.id },\n            update: updateData,\n            create: {\n                userId: session.user.id!,\n                alpacaKeyId: alpacaKeyId ? await encrypt(alpacaKeyId) : '',\n                alpacaSecret: alpacaSecret ? await encrypt(alpacaSecret) : '',\n                fmpApiKey: fmpApiKey ? await encrypt(fmpApiKey) : null,\n                finnhubApiKey: finnhubApiKey ? await encrypt(finnhubApiKey) : null,\n                eodhdApiKey: eodhdApiKey ? await encrypt(eodhdApiKey) : null,\n                ipinfoToken: ipinfoToken ? await encrypt(ipinfoToken) : null,\n                googleApiKey: googleApiKey ? await encrypt(googleApiKey) : null,\n            },\n        });\n\n        return NextResponse.json({ message: 'Credentials updated successfully' });\n    } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n        logger.error('Error updating credentials', { error: errorMessage });\n        return NextResponse.json({ message: 'Internal Server Error' }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/user/profile/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/user/settings/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":12,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/auth';\nimport { prisma } from '@/lib/db/prisma';\nimport { z } from 'zod';\n\nconst settingsSchema = z.object({\n    theme: z.enum(['light', 'dark', 'system']).optional(),\n    defaultRiskPercent: z.number().min(0.1).max(10).optional(),\n    currency: z.string().optional(),\n});\n\nexport async function GET(req: Request) {\n    const session = await auth();\n\n    if (!session || !session.user) {\n        return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\n    }\n\n    try {\n        const settings = await prisma.userSettings.findUnique({\n            where: { userId: session.user.id },\n        });\n\n        return NextResponse.json(settings || { theme: 'dark', defaultRiskPercent: 1.0 });\n    } catch (error) {\n        console.error('Error fetching settings:', error);\n        return NextResponse.json({ message: 'Internal Server Error' }, { status: 500 });\n    }\n}\n\nexport async function POST(req: Request) {\n    const session = await auth();\n\n    if (!session || !session.user) {\n        return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });\n    }\n\n    try {\n        const body = await req.json();\n        const result = settingsSchema.safeParse(body);\n\n        if (!result.success) {\n            return NextResponse.json({ message: 'Invalid input', errors: result.error.issues }, { status: 400 });\n        }\n\n        const { theme, defaultRiskPercent, currency } = result.data;\n\n        const settings = await prisma.userSettings.upsert({\n            where: { userId: session.user.id },\n            update: {\n                ...(theme && { theme }),\n                ...(defaultRiskPercent !== undefined && { defaultRiskPercent }),\n                ...(currency && { currency }),\n            },\n            create: {\n                userId: session.user.id!,\n                theme: theme || 'dark',\n                defaultRiskPercent: defaultRiskPercent || 1.0,\n                currency: currency || 'USD',\n            },\n        });\n\n        return NextResponse.json({ message: 'Settings updated successfully', settings });\n    } catch (error) {\n        console.error('Error updating settings:', error);\n        return NextResponse.json({ message: 'Internal Server Error' }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/watchlist/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/api/watchlist/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/asset/[...symbol]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/budgets/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/budgets/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/crypto/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/crypto/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/finance/goals/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/finance/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/finance/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/finance/transactions/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/forex/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/forex/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/layout.tsx","messages":[{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":40,"column":9,"nodeType":"JSXOpeningElement","endLine":43,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './globals.css';\nimport type { Metadata, Viewport } from 'next';\nimport { MarketProvider } from '@/context/MarketContext';\nimport AuthProvider from '@/components/auth/AuthProvider';\nimport { ToastProvider } from '@/components/ui/Toast';\nimport { ThemeProvider } from '@/context/ThemeContext';\nimport Header from '@/components/Header';\nimport ClientShell from '@/components/ClientShell';\n\nexport const metadata: Metadata = {\n  title: {\n    default: 'MarketX — Professional Trading Platform',\n    template: '%s | MarketX',\n  },\n  description: 'Real-time market insights, portfolio management, and intelligent trading with Stacked Edge™ analytics.',\n  keywords: ['trading', 'stocks', 'crypto', 'forex', 'portfolio', 'market analysis'],\n  manifest: '/manifest.json',\n  appleWebApp: {\n    capable: true,\n    statusBarStyle: 'default',\n    title: 'MarketX',\n  },\n};\n\nexport const viewport: Viewport = {\n  themeColor: '#0d1117',\n  width: 'device-width',\n  initialScale: 1,\n  maximumScale: 1,\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\" suppressHydrationWarning>\n      <head>\n        <link\n          href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap\"\n          rel=\"stylesheet\"\n        />\n      </head>\n      <body suppressHydrationWarning>\n        <AuthProvider>\n          <ToastProvider>\n            <ThemeProvider>\n              <MarketProvider>\n                <div className=\"min-h-screen bg-[#0d1117] text-gray-100 flex flex-col\">\n                  <Header />\n                  <div className=\"h-16\"></div> {/* Spacer for fixed header */}\n                  <div className=\"h-16\"></div> {/* Spacer for fixed header */}\n                  <main className=\"flex-1 container mx-auto px-4 py-8\">\n                    <ClientShell>\n                      {children}\n                    </ClientShell>\n                  </main>\n                </div>\n              </MarketProvider>\n            </ThemeProvider>\n          </ToastProvider>\n        </AuthProvider>\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/login/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":57,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { signIn } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { Mail, Lock, AlertCircle, Loader2, ArrowRight, Eye, EyeOff, TrendingUp, BarChart3, Shield } from 'lucide-react';\n\nexport default function LoginPage() {\n    const router = useRouter();\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [code, setCode] = useState('');\n    const [show2FA, setShow2FA] = useState(false);\n    const [error, setError] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [showPassword, setShowPassword] = useState(false);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        setLoading(true);\n\n        try {\n            // Step 1: Check if 2FA is required (only if not already showing 2FA input)\n            if (!show2FA) {\n                const checkRes = await fetch('/api/auth/2fa/check', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ email, password }),\n                });\n\n                const checkData = await checkRes.json();\n\n                if (checkData.require2fa) {\n                    setShow2FA(true);\n                    setLoading(false);\n                    return;\n                }\n            }\n\n            // Step 2: Attempt Sign In\n            const result = await signIn('credentials', {\n                email,\n                password,\n                code: show2FA ? code : undefined,\n                redirect: false,\n            });\n\n            if (result?.error) {\n                setError('Invalid credentials');\n                setLoading(false);\n            } else {\n                router.push('/portfolio');\n                router.refresh();\n            }\n        } catch (err) {\n            setError('An error occurred. Please try again.');\n            setLoading(false);\n        }\n    };\n\n    return (\n        <>\n            <style>{`\n                .custom-input::placeholder { color: #4b5563; }\n                .custom-input:hover { border-color: #4b5563; }\n                .custom-input:focus { border-color: rgba(59,130,246,0.7); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }\n                .group:focus-within .icon { color: #60a5fa; }\n                .custom-button:hover { background: linear-gradient(to right, #3b82f6, #6366f1); box-shadow: 0 10px 15px -3px rgba(99,102,241,0.3), 0 4px 6px -2px rgba(99,102,241,0.05); }\n                .custom-button:active { transform: scale(0.98); }\n                .custom-button:disabled { opacity: 0.6; cursor: not-allowed; }\n                .forgot-link:hover { color: #a5b4fc; }\n                .create-link:hover { color: #a5b4fc; }\n                .eye-button:hover { color: #9ca3af; }\n                @media (min-width: 1024px) {\n                    .left-panel { display: flex !important; }\n                    .mobile-logo { display: none !important; }\n                    .form-padding { padding: 2.5rem !important; }\n                    .right-padding { padding: 3rem !important; }\n                }\n            `}</style>\n            <div style={{\n                minHeight: 'calc(100vh - 4rem)',\n                display: 'flex',\n                position: 'relative',\n                overflow: 'hidden',\n                backgroundColor: '#0d1117'\n            }}>\n                {/* Background Effects */}\n                <div style={{ position: 'absolute', top: '0', left: '25%', width: '600px', height: '600px', backgroundColor: 'rgba(37, 99, 235, 0.08)', borderRadius: '9999px', filter: 'blur(150px)', pointerEvents: 'none' }} />\n                <div style={{ position: 'absolute', bottom: '0', right: '25%', width: '600px', height: '600px', backgroundColor: 'rgba(79, 70, 229, 0.08)', borderRadius: '9999px', filter: 'blur(150px)', pointerEvents: 'none' }} />\n\n                {/* Left Panel — Branding (hidden on mobile) */}\n                <div className=\"left-panel\" style={{ display: 'none', flex: '1', alignItems: 'center', justifyContent: 'center', padding: '3rem', position: 'relative' }}>\n                    <div style={{ maxWidth: '28rem' }}>\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '2rem' }}>\n                            <div style={{ width: '2.5rem', height: '2.5rem', borderRadius: '0.75rem', background: 'linear-gradient(to bottom right, #2563eb, #4f46e5)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', fontSize: '1.125rem', boxShadow: '0 10px 15px -3px rgba(59,130,246,0.2), 0 4px 6px -2px rgba(59,130,246,0.05)' }}>M</div>\n                            <span style={{ fontSize: '1.25rem', fontWeight: 'bold', color: 'white' }}>MarketX</span>\n                        </div>\n\n                        <h1 style={{ fontSize: '2.25rem', fontWeight: 'bold', color: 'white', lineHeight: '1.25', marginBottom: '1rem' }}>\n                            Professional Trading,<br />\n                            <span style={{ background: 'linear-gradient(to right, #60a5fa, #818cf8)', backgroundClip: 'text', color: 'transparent' }}>Simplified.</span>\n                        </h1>\n                        <p style={{ color: '#9ca3af', fontSize: '1.125rem', lineHeight: '1.75', marginBottom: '2.5rem' }}>\n                            Real-time market analysis, portfolio management, and intelligent order execution — all in one platform.\n                        </p>\n\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\n                            {[\n                                { icon: TrendingUp, label: 'Real-time market data & analytics' },\n                                { icon: BarChart3, label: 'Advanced portfolio tracking' },\n                                { icon: Shield, label: 'Secure broker integration' },\n                            ].map((feature, i) => (\n                                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\n                                    <div style={{ width: '2.25rem', height: '2.25rem', borderRadius: '0.5rem', backgroundColor: 'rgba(59,130,246,0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                                        <feature.icon style={{ width: '1.125rem', height: '1.125rem', color: '#60a5fa' }} />\n                                    </div>\n                                    <span style={{ color: '#d1d5db', fontSize: '0.875rem', fontWeight: '500' }}>{feature.label}</span>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Right Panel — Form */}\n                <div className=\"right-padding\" style={{ flex: '1', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1.5rem' }}>\n                    <div style={{ width: '100%', maxWidth: '26.25rem' }}>\n                        <div className=\"form-padding\" style={{ backgroundColor: 'rgba(22,27,34,0.9)', backdropFilter: 'blur(16px)', border: '1px solid rgba(31,41,55,0.6)', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.2)', borderRadius: '1rem', padding: '2rem' }}>\n                            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>\n                                <div className=\"mobile-logo\" style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '3rem', height: '3rem', borderRadius: '0.75rem', background: 'linear-gradient(to bottom right, #2563eb, #4f46e5)', boxShadow: '0 10px 15px -3px rgba(59,130,246,0.2), 0 4px 6px -2px rgba(59,130,246,0.05)', marginBottom: '1.25rem' }}>\n                                    <span style={{ fontSize: '1.25rem', fontWeight: 'bold', color: 'white' }}>M</span>\n                                </div>\n                                <h2 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: 'white', marginBottom: '0.375rem' }}>{show2FA ? 'Two-Factor Authentication' : 'Welcome back'}</h2>\n                                <p style={{ color: '#6b7280', fontSize: '0.875rem' }}>{show2FA ? 'Enter the code from your authenticator app' : 'Sign in to your trading account'}</p>\n                            </div>\n\n                            <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\n                                {error && (\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.625rem', padding: '0.875rem', fontSize: '0.875rem', color: '#f87171', backgroundColor: 'rgba(239,68,68,0.08)', border: '1px solid rgba(239,68,68,0.2)', borderRadius: '0.75rem' }}>\n                                        <AlertCircle size={16} style={{ flexShrink: 0 }} />\n                                        {error}\n                                    </div>\n                                )}\n\n                                {!show2FA ? (\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\n                                            <label style={{ fontSize: '0.75rem', fontWeight: '600', color: '#9ca3af', textTransform: 'uppercase', letterSpacing: '0.05em', marginLeft: '0.125rem' }}>Email</label>\n                                            <div className=\"group\" style={{ position: 'relative' }}>\n                                                <input type=\"email\" required value={email} onChange={(e) => setEmail(e.target.value)} className=\"custom-input\" style={{ width: '100%', backgroundColor: '#0d1117', borderWidth: '1px', borderStyle: 'solid', borderColor: 'rgba(55,65,81,0.6)', borderRadius: '0.75rem', padding: '0.875rem 2.75rem 0.875rem 2.75rem', color: 'white', fontSize: '0.875rem', transition: 'all 0.2s', outline: 'none', boxSizing: 'border-box' }} placeholder=\"name@example.com\" />\n                                                <Mail className=\"icon\" style={{ position: 'absolute', left: '0.875rem', top: '50%', transform: 'translateY(-50%)', height: '1.125rem', width: '1.125rem', color: '#4b5563', transition: 'color 0.2s' }} />\n                                            </div>\n                                        </div>\n\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginLeft: '0.125rem' }}>\n                                                <label style={{ fontSize: '0.75rem', fontWeight: '600', color: '#9ca3af', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Password</label>\n                                                <Link href=\"#\" className=\"forgot-link\" style={{ fontSize: '0.75rem', color: 'rgba(96,165,250,0.8)', transition: 'color 0.2s', fontWeight: '500' }}>Forgot password?</Link>\n                                            </div>\n                                            <div className=\"group\" style={{ position: 'relative' }}>\n                                                <input type={showPassword ? 'text' : 'password'} required value={password} onChange={(e) => setPassword(e.target.value)} className=\"custom-input\" style={{ width: '100%', backgroundColor: '#0d1117', borderWidth: '1px', borderStyle: 'solid', borderColor: 'rgba(55,65,81,0.6)', borderRadius: '0.75rem', padding: '0.875rem 2.75rem 0.875rem 2.75rem', color: 'white', fontSize: '0.875rem', transition: 'all 0.2s', outline: 'none', boxSizing: 'border-box' }} placeholder=\"Enter your password\" />\n                                                <Lock className=\"icon\" style={{ position: 'absolute', left: '0.875rem', top: '50%', transform: 'translateY(-50%)', height: '1.125rem', width: '1.125rem', color: '#4b5563', transition: 'color 0.2s' }} />\n                                                <button type=\"button\" onClick={() => setShowPassword(!showPassword)} className=\"eye-button\" style={{ position: 'absolute', right: '0.75rem', top: '50%', transform: 'translateY(-50%)', padding: '0.125rem', color: '#4b5563', transition: 'color 0.2s', background: 'none', border: 'none', cursor: 'pointer' }} tabIndex={-1}>\n                                                    {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\n                                        <label style={{ fontSize: '0.75rem', fontWeight: '600', color: '#9ca3af', textTransform: 'uppercase', letterSpacing: '0.05em', marginLeft: '0.125rem' }}>Authentication Code</label>\n                                        <div className=\"group\" style={{ position: 'relative' }}>\n                                            <input type=\"text\" required value={code} onChange={(e) => setCode(e.target.value.replace(/\\D/g, '').slice(0, 6))} className=\"custom-input\" style={{ width: '100%', backgroundColor: '#0d1117', borderWidth: '1px', borderStyle: 'solid', borderColor: 'rgba(55,65,81,0.6)', borderRadius: '0.75rem', padding: '0.875rem 2.75rem 0.875rem 2.75rem', color: 'white', fontSize: '1.25rem', letterSpacing: '0.25em', textAlign: 'center', fontFamily: 'monospace', transition: 'all 0.2s', outline: 'none', boxSizing: 'border-box' }} placeholder=\"000 000\" autoFocus />\n                                            <Shield className=\"icon\" style={{ position: 'absolute', left: '0.875rem', top: '50%', transform: 'translateY(-50%)', height: '1.125rem', width: '1.125rem', color: '#4b5563', transition: 'color 0.2s' }} />\n                                        </div>\n                                        <button type=\"button\" onClick={() => setShow2FA(false)} className=\"text-sm text-gray-500 hover:text-gray-300 mt-2\">Use a different account</button>\n                                    </div>\n                                )}\n\n                                <button type=\"submit\" disabled={loading} className=\"custom-button\" style={{ width: '100%', background: 'linear-gradient(to right, #2563eb, #4f46e5)', color: 'white', fontWeight: '600', padding: '0.875rem', borderRadius: '0.75rem', boxShadow: '0 10px 15px -3px rgba(37,99,235,0.2), 0 4px 6px -2px rgba(37,99,235,0.05)', transition: 'all 0.2s', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem', fontSize: '0.875rem', border: 'none', cursor: 'pointer' }}>\n                                    {loading ? (\n                                        <>\n                                            <Loader2 style={{ height: '1rem', width: '1rem', animation: 'spin 1s linear infinite' }} />\n                                            <span>{show2FA ? 'Verifying...' : 'Signing in...'}</span>\n                                        </>\n                                    ) : (\n                                        <>\n                                            <span>{show2FA ? 'Verify Code' : 'Sign In'}</span>\n                                            <ArrowRight style={{ height: '1rem', width: '1rem' }} />\n                                        </>\n                                    )}\n                                </button>\n                            </form>\n\n                            <div style={{ marginTop: '2rem', paddingTop: '1.5rem', borderTop: '1px solid rgba(31,41,55,0.5)', textAlign: 'center' }}>\n                                <p style={{ color: 'white', fontSize: '0.875rem' }}>Don&apos;t have an account? <Link href=\"/register\" className=\"create-link\" style={{ color: '#60a5fa', fontWeight: '600', transition: 'color 0.2s' }}>Create account</Link></p>\n                                <p style={{ textAlign: 'center', fontSize: '1rem', color: 'white', marginTop: '1.5rem' }}>By signing in, you agree to our Terms of Service and Privacy Policy.</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/market/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/market/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/not-found.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowLeft' is defined but never used.","line":4,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowLeft"},"fix":{"range":[58,69],"text":""},"desc":"Remove unused variable \"ArrowLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":4,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[69,77],"text":""},"desc":"Remove unused variable \"Search\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { Home, ArrowLeft, Search, TrendingUp } from 'lucide-react';\n\nexport default function NotFound() {\n    return (\n        <div className=\"min-h-[calc(100vh-4rem)] flex items-center justify-center p-4 relative overflow-hidden\">\n            {/* Background Effects */}\n            <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-600/10 rounded-full blur-[128px] pointer-events-none\" />\n            <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[128px] pointer-events-none\" />\n\n            <div className=\"text-center relative z-10 max-w-lg\">\n                {/* 404 Badge */}\n                <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-red-500/20 to-orange-500/20 border border-red-500/30 mb-6\">\n                    <span className=\"text-3xl font-black text-red-400\">404</span>\n                </div>\n\n                <h1 className=\"text-3xl font-bold text-white mb-3\">\n                    Page Not Found\n                </h1>\n                <p className=\"text-gray-400 mb-8 leading-relaxed\">\n                    The page you&apos;re looking for doesn&apos;t exist or has been moved.\n                    This might be a broken link or a mistyped URL.\n                </p>\n\n                <div className=\"flex flex-col sm:flex-row items-center justify-center gap-3\">\n                    <Link\n                        href=\"/\"\n                        className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-medium rounded-xl shadow-lg shadow-blue-500/25 transition-all active:scale-[0.98]\"\n                    >\n                        <Home className=\"w-4 h-4\" />\n                        Go to Dashboard\n                    </Link>\n                    <Link\n                        href=\"/market\"\n                        className=\"flex items-center gap-2 px-6 py-3 bg-gray-800/80 hover:bg-gray-700/80 text-gray-300 hover:text-white font-medium rounded-xl border border-gray-700/50 transition-all\"\n                    >\n                        <TrendingUp className=\"w-4 h-4\" />\n                        Browse Markets\n                    </Link>\n                </div>\n\n                {/* Quick links */}\n                <div className=\"mt-12 pt-8 border-t border-gray-800/50\">\n                    <p className=\"text-xs text-gray-500 uppercase tracking-widest font-bold mb-4\">Quick Links</p>\n                    <div className=\"flex flex-wrap justify-center gap-4 text-sm\">\n                        {[\n                            { name: 'Portfolio', path: '/portfolio' },\n                            { name: 'Stocks', path: '/stocks' },\n                            { name: 'Crypto', path: '/crypto' },\n                            { name: 'Watchlist', path: '/watchlist' },\n                        ].map((link) => (\n                            <Link\n                                key={link.path}\n                                href={link.path}\n                                className=\"text-gray-400 hover:text-blue-400 transition-colors\"\n                            >\n                                {link.name}\n                            </Link>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/portfolio/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/portfolio/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/pricing/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/pricing/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/profile/CurrencyDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/profile/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/register/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/settings/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/stocks/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/stocks/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/watchlist/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/app/watchlist/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":135,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useWatchlist } from '@/hooks/useWatchlist';\nimport AssetCard from '@/components/AssetCard';\nimport { Asset } from '@/lib/types';\nimport { Plus, Edit2, Trash2, Check, X, TrendingUp, Loader2 } from 'lucide-react';\nimport Link from 'next/link';\nimport AuthGuard from '@/components/auth/AuthGuard';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\n\n// Constants\nconst REFRESH_INTERVAL = 30000; // 30 seconds\nconst ASSET_CLASS = 'stock' as const;\n\n// Types\ninterface AssetsState {\n    data: Record<string, Asset>;\n    loading: boolean;\n    error: string | null;\n}\n\n// Components\nconst LoadingSpinner = () => (\n    <div className=\"flex items-center justify-center min-h-[50vh]\">\n        <div className=\"relative\">\n            <div className=\"w-12 h-12 rounded-full border-4 border-indigo-500/30 border-t-indigo-500 animate-spin\" />\n        </div>\n    </div>\n);\n\nconst ErrorDisplay = ({ error }: { error: string }) => (\n    <div className=\"max-w-2xl mx-auto mt-16 p-6 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-center\">\n        <p className=\"text-lg font-medium\">Error loading watchlists</p>\n        <p className=\"text-sm mt-2\">{error}</p>\n    </div>\n);\n\nconst EmptyState = ({\n    icon: Icon,\n    title,\n    description,\n    action\n}: {\n    icon: React.ElementType;\n    title: string;\n    description: React.ReactNode;\n    action?: React.ReactNode;\n}) => (\n    <div className=\"bg-[#0d1117]/50 border border-gray-800 rounded-xl p-12 text-center\">\n        <div className=\"inline-flex p-4 bg-gray-800/20 rounded-full border border-gray-700/30 mb-4\">\n            <Icon className=\"w-12 h-12 text-gray-500\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-white mb-2\">{title}</h3>\n        <div className=\"text-gray-400 max-w-sm mx-auto\">{description}</div>\n        {action && <div className=\"mt-6\">{action}</div>}\n    </div>\n);\n\nconst AssetSkeleton = () => (\n    <div className=\"h-40 bg-[#161b22] border border-gray-800 rounded-xl p-6 animate-pulse\">\n        <div className=\"flex justify-between items-start\">\n            <div className=\"h-6 w-20 bg-gray-700 rounded\" />\n            <div className=\"h-8 w-8 bg-gray-700 rounded-lg\" />\n        </div>\n        <div className=\"mt-4 space-y-2\">\n            <div className=\"h-8 w-32 bg-gray-700 rounded\" />\n            <div className=\"h-4 w-24 bg-gray-800 rounded\" />\n        </div>\n    </div>\n);\n\nexport default function WatchlistPage() {\n    const { watchlists, loading, error, createWatchlist, renameWatchlist, deleteWatchlist } = useWatchlist();\n\n    // State\n    const [selectedWatchlistId, setSelectedWatchlistId] = useState<string | null>(null);\n    const [assets, setAssets] = useState<AssetsState>({\n        data: {},\n        loading: false,\n        error: null\n    });\n    const [isCreating, setIsCreating] = useState(false);\n    const [newListName, setNewListName] = useState('');\n    const [editingId, setEditingId] = useState<string | null>(null);\n    const [editingName, setEditingName] = useState('');\n    const [deletingId, setDeletingId] = useState<string | null>(null);\n\n    // Memoized values\n    const activeWatchlist = useMemo(\n        () => watchlists.find(w => w.id === selectedWatchlistId),\n        [watchlists, selectedWatchlistId]\n    );\n\n    // Auto-select first watchlist\n    useEffect(() => {\n        if (watchlists.length > 0 && !selectedWatchlistId) {\n            setSelectedWatchlistId(watchlists[0].id);\n        }\n    }, [watchlists, selectedWatchlistId]);\n\n    // Fetch asset prices\n    const fetchAssetPrices = useCallback(async (symbols: string[]) => {\n        if (!symbols.length) return;\n\n        setAssets(prev => ({ ...prev, loading: true, error: null }));\n\n        try {\n            const newAssets: Record<string, Asset> = {};\n\n            await Promise.all(\n                symbols.map(async (symbol) => {\n                    try {\n                        const response = await fetch(`/api/market-data?symbol=${encodeURIComponent(symbol)}`);\n                        if (!response.ok) return;\n\n                        const data = await response.json();\n                        if (data.symbol) {\n                            newAssets[symbol] = {\n                                symbol: data.symbol,\n                                name: data.name || data.symbol,\n                                price: data.price ?? 0,\n                                change: data.change ?? 0,\n                                changePercent: data.changePercent ?? 0,\n                                assetClass: data.assetClass || ASSET_CLASS,\n                            };\n                        }\n                    } catch (error) {\n                        console.error(`Failed to fetch ${symbol}:`, error);\n                    }\n                })\n            );\n\n            setAssets({ data: newAssets, loading: false, error: null });\n        } catch (error) {\n            setAssets(prev => ({\n                ...prev,\n                loading: false,\n                error: 'Failed to fetch asset prices'\n            }));\n        }\n    }, []);\n\n    // Initial fetch and refresh interval\n    useEffect(() => {\n        if (!activeWatchlist?.symbols.length) {\n            setAssets({ data: {}, loading: false, error: null });\n            return;\n        }\n\n        fetchAssetPrices(activeWatchlist.symbols);\n\n        const intervalId = setInterval(\n            () => fetchAssetPrices(activeWatchlist.symbols),\n            REFRESH_INTERVAL\n        );\n\n        return () => clearInterval(intervalId);\n    }, [activeWatchlist, fetchAssetPrices]);\n\n    // Handlers\n    const handleCreateList = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newListName.trim()) return;\n\n        setIsCreating(true);\n        try {\n            const newList = await createWatchlist(newListName.trim());\n            setNewListName('');\n            setSelectedWatchlistId(newList.id);\n        } catch (error) {\n            console.error('Failed to create watchlist:', error);\n        } finally {\n            setIsCreating(false);\n        }\n    };\n\n    const handleStartRename = (watchlistId: string, currentName: string) => {\n        setEditingId(watchlistId);\n        setEditingName(currentName);\n    };\n\n    const handleSaveRename = async (watchlistId: string) => {\n        const trimmedName = editingName.trim();\n        const originalName = watchlists.find(w => w.id === watchlistId)?.name;\n\n        if (!trimmedName || trimmedName === originalName) {\n            setEditingId(null);\n            return;\n        }\n\n        try {\n            await renameWatchlist(watchlistId, trimmedName);\n            setEditingId(null);\n        } catch (error) {\n            console.error('Failed to rename watchlist:', error);\n        }\n    };\n\n    const handleDelete = async (watchlistId: string) => {\n        try {\n            await deleteWatchlist(watchlistId);\n            setDeletingId(null);\n            if (selectedWatchlistId === watchlistId) {\n                setSelectedWatchlistId(watchlists[0]?.id ?? null);\n            }\n        } catch (error) {\n            console.error('Failed to delete watchlist:', error);\n        }\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent, action: () => void, cancel: () => void) => {\n        if (e.key === 'Enter') action();\n        if (e.key === 'Escape') cancel();\n    };\n\n    // Loading and error states\n    if (loading && !watchlists.length) return <LoadingSpinner />;\n    if (error) return <ErrorDisplay error={error} />;\n\n    return (\n        <AuthGuard>\n            <div className=\"max-w-7xl mx-auto px-4 py-8\">\n                {/* Header */}\n                <header className=\"mb-8\">\n                    <div className=\"bg-gradient-to-r from-[#0d1117]/80 to-transparent p-6 rounded-xl border-l-4 border-indigo-500 backdrop-blur-sm\">\n                        <h1 className=\"text-3xl font-extrabold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent\">\n                            My Watchlists\n                        </h1>\n                    </div>\n                </header>\n\n                {/* Watchlist Tabs */}\n                <div className=\"flex items-center gap-3 mb-8 overflow-x-auto pb-2 scrollbar-hide\">\n                    {watchlists.map((watchlist) => {\n                        const isActive = selectedWatchlistId === watchlist.id;\n                        const isEditing = editingId === watchlist.id;\n\n                        return (\n                            <div\n                                key={watchlist.id}\n                                className={`\n                flex items-center gap-2 px-4 py-2 rounded-full transition-all\n                ${isActive\n                                        ? 'bg-indigo-600/90 border border-indigo-400 shadow-lg shadow-indigo-600/40 text-white'\n                                        : 'bg-gray-800/80 border border-gray-600 text-gray-200 hover:bg-gray-700'\n                                    }\n              `}\n                            >\n                                {isEditing ? (\n                                    <div className=\"flex items-center gap-1\">\n                                        <input\n                                            type=\"text\"\n                                            value={editingName}\n                                            onChange={(e) => setEditingName(e.target.value)}\n                                            onKeyDown={(e) => handleKeyDown(\n                                                e,\n                                                () => handleSaveRename(watchlist.id),\n                                                () => setEditingId(null)\n                                            )}\n                                            className=\"px-2 py-1 bg-gray-900 border border-gray-600 rounded text-sm min-w-[120px] text-white focus:outline-none focus:border-indigo-500\"\n                                            autoFocus\n                                        />\n                                        <button\n                                            onClick={() => handleSaveRename(watchlist.id)}\n                                            className=\"p-1 hover:bg-green-600/20 rounded-full transition-colors\"\n                                            aria-label=\"Save rename\"\n                                        >\n                                            <Check size={16} className=\"text-green-400\" />\n                                        </button>\n                                        <button\n                                            onClick={() => setEditingId(null)}\n                                            className=\"p-1 hover:bg-red-600/20 rounded-full transition-colors\"\n                                            aria-label=\"Cancel rename\"\n                                        >\n                                            <X size={16} className=\"text-red-400\" />\n                                        </button>\n                                    </div>\n                                ) : (\n                                    <>\n                                        <button\n                                            onClick={() => setSelectedWatchlistId(watchlist.id)}\n                                            className=\"font-medium text-sm whitespace-nowrap\"\n                                        >\n                                            {watchlist.name}\n                                            <span className=\"ml-1 text-xs opacity-75\">\n                                                ({watchlist.symbols.length})\n                                            </span>\n                                        </button>\n                                        <div className=\"flex gap-1 pl-2 border-l border-white/20\">\n                                            <button\n                                                onClick={() => handleStartRename(watchlist.id, watchlist.name)}\n                                                className=\"p-1 hover:bg-white/10 rounded-full transition-colors\"\n                                                aria-label=\"Rename watchlist\"\n                                            >\n                                                <Edit2 size={12} />\n                                            </button>\n                                            <button\n                                                onClick={() => setDeletingId(watchlist.id)}\n                                                className=\"p-1 hover:bg-red-500/20 rounded-full transition-colors\"\n                                                aria-label=\"Delete watchlist\"\n                                            >\n                                                <Trash2 size={12} className=\"text-red-400\" />\n                                            </button>\n                                        </div>\n                                    </>\n                                )}\n                            </div>\n                        );\n                    })}\n\n                    {/* Create New Watchlist */}\n                    {isCreating ? (\n                        <form onSubmit={handleCreateList} className=\"flex items-center gap-1 bg-gray-800 border border-gray-700 rounded-full px-2 py-1\">\n                            <input\n                                type=\"text\"\n                                value={newListName}\n                                onChange={(e) => setNewListName(e.target.value)}\n                                placeholder=\"List name\"\n                                className=\"px-2 py-1 bg-transparent text-sm min-w-[120px] text-white focus:outline-none\"\n                                autoFocus\n                            />\n                            <button\n                                type=\"submit\"\n                                className=\"p-1 bg-indigo-600 hover:bg-indigo-500 rounded-full text-white transition-colors\"\n                                aria-label=\"Create watchlist\"\n                            >\n                                <Check size={14} />\n                            </button>\n                            <button\n                                type=\"button\"\n                                onClick={() => {\n                                    setIsCreating(false);\n                                    setNewListName('');\n                                }}\n                                className=\"p-1 hover:bg-gray-700 rounded-full text-gray-400 transition-colors\"\n                                aria-label=\"Cancel creation\"\n                            >\n                                <X size={14} />\n                            </button>\n                        </form>\n                    ) : (\n                        <button\n                            onClick={() => setIsCreating(true)}\n                            className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-gray-800/30 border border-dashed border-gray-600 text-gray-400 hover:bg-gray-800 hover:text-white hover:border-gray-500 transition-all text-sm\"\n                        >\n                            <Plus size={16} />\n                            <span className=\"font-medium\">New List</span>\n                        </button>\n                    )}\n                </div>\n\n                {/* Delete Confirmation Modal */}\n                {deletingId && (\n                    <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                        <div className=\"bg-[#0d1117] border border-gray-700 rounded-xl max-w-md w-full p-6 shadow-2xl\">\n                            <h3 className=\"text-xl font-bold text-white mb-2\">Delete Watchlist?</h3>\n                            <p className=\"text-gray-400 mb-6\">\n                                Are you sure you want to delete{' '}\n                                <span className=\"font-semibold text-white\">\n                                    &quot;{watchlists.find(w => w.id === deletingId)?.name}&quot;\n                                </span>\n                                ? This action cannot be undone.\n                            </p>\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => handleDelete(deletingId)}\n                                    className=\"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\n                                >\n                                    Delete\n                                </button>\n                                <button\n                                    onClick={() => setDeletingId(null)}\n                                    className=\"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg font-medium border border-gray-700 transition-colors\"\n                                >\n                                    Cancel\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Watchlist Content */}\n                <ErrorBoundary>\n                    {!activeWatchlist ? (\n                        <EmptyState\n                            icon={Plus}\n                            title=\"Start Your Watchlist Journey\"\n                            description=\"Create your first watchlist to track market movements.\"\n                        />\n                    ) : activeWatchlist.symbols.length === 0 ? (\n                        <EmptyState\n                            icon={TrendingUp}\n                            title=\"Watchlist is Empty\"\n                            description={\n                                <>\n                                    Head over to the{' '}\n                                    <Link href=\"/market\" className=\"text-indigo-400 hover:text-indigo-300 font-medium\">\n                                        Market page\n                                    </Link>{' '}\n                                    to discover and add assets to{' '}\n                                    <span className=\"text-indigo-400 font-medium\">&quot;{activeWatchlist.name}&quot;</span>.\n                                </>\n                            }\n                            action={\n                                <Link\n                                    href=\"/market\"\n                                    className=\"inline-flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-indigo-900/30\"\n                                >\n                                    Explore Markets\n                                </Link>\n                            }\n                        />\n                    ) : (\n                        <>\n                            {/* Refresh indicator */}\n                            {assets.loading && (\n                                <div className=\"flex items-center justify-end gap-2 mb-4 text-sm text-gray-400\">\n                                    <Loader2 size={16} className=\"animate-spin\" />\n                                    <span>Updating prices...</span>\n                                </div>\n                            )}\n\n                            {/* Assets grid */}\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                {activeWatchlist.symbols.map(symbol =>\n                                    assets.data[symbol] ? (\n                                        <AssetCard key={symbol} {...assets.data[symbol]} />\n                                    ) : (\n                                        <AssetSkeleton key={symbol} />\n                                    )\n                                )}\n                            </div>\n\n                            {/* Error message */}\n                            {assets.error && (\n                                <div className=\"mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm\">\n                                    {assets.error}\n                                </div>\n                            )}\n                        </>\n                    )}\n                </ErrorBoundary>\n            </div>\n        </AuthGuard>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/AdvancedOrderPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[32,43],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_assetClass' is assigned a value but never used.","line":19,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { TrendingUp, TrendingDown, Settings } from 'lucide-react';\nimport RiskCalculator from './RiskCalculator';\nimport { useAccount } from '@/hooks/useAccount';\nimport { useOrders } from '@/hooks/useOrders';\nimport type { OrderRequest } from '@/lib/brokers/types';\n\ninterface AdvancedOrderPanelProps {\n    symbol: string;\n    currentPrice?: number;\n    assetClass?: string;\n}\n\nexport default function AdvancedOrderPanel({\n    symbol,\n    currentPrice = 0,\n    assetClass: _assetClass = 'stock', // Future use, currently defaults to 'stock' logic\n}: AdvancedOrderPanelProps) {\n    // Form State\n    const [activeTab, setActiveTab] = useState<'simple' | 'advanced'>('simple');\n    const [orderType, setOrderType] = useState<'market' | 'limit'>('market');\n    const [side, setSide] = useState<'buy' | 'sell'>('buy');\n    const [quantity, setQuantity] = useState(1);\n    const [limitPrice, setLimitPrice] = useState(currentPrice);\n\n    // Bracket Order State\n    const [useBracketOrder, setUseBracketOrder] = useState(false);\n    const [stopLossPrice, setStopLossPrice] = useState(0);\n    const [takeProfitPrice, setTakeProfitPrice] = useState(0);\n\n    // UI Feedback State\n    const [message, setMessage] = useState('');\n\n    // Custom Hooks\n    const { account, position, refetch: refetchAccount } = useAccount({ pollInterval: 5000, symbol });\n    const { submitOrder, submitting, error: submitError } = useOrders();\n\n    // Default prices when currentPrice updates (only set once when price first becomes available)\n    const [hasSetDefaults, setHasSetDefaults] = useState(false);\n    if (currentPrice > 0 && !hasSetDefaults) {\n        setLimitPrice(currentPrice);\n        setStopLossPrice(parseFloat((currentPrice * 0.95).toFixed(2)));\n        setTakeProfitPrice(parseFloat((currentPrice * 1.15).toFixed(2)));\n        setHasSetDefaults(true);\n    }\n\n    // Reset some state when symbol changes\n    const [prevSymbol, setPrevSymbol] = useState(symbol);\n    if (symbol !== prevSymbol) {\n        setPrevSymbol(symbol);\n        setMessage('');\n        setQuantity(1);\n        setUseBracketOrder(false);\n        setHasSetDefaults(false); // Allow re-setting defaults for the new symbol\n    }\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setMessage('');\n\n        const orderRequest: OrderRequest = {\n            symbol,\n            qty: quantity,\n            side,\n            type: orderType,\n            time_in_force: 'gtc',\n        };\n\n        if (orderType === 'limit') {\n            orderRequest.limit_price = limitPrice;\n        }\n\n        // Add bracket order fields if enabled\n        if (useBracketOrder && stopLossPrice && takeProfitPrice) {\n            orderRequest.order_class = 'bracket';\n            orderRequest.take_profit = {\n                limit_price: takeProfitPrice,\n            };\n            orderRequest.stop_loss = {\n                stop_price: stopLossPrice,\n            };\n        }\n\n        const result = await submitOrder(orderRequest);\n\n        if (result.success) {\n            setMessage(result.message || 'Order submitted successfully');\n            // Reset quantity to 1 after success\n            setQuantity(1);\n            // Refresh account data immediately\n            refetchAccount();\n        } else {\n            setMessage(`Error: ${submitError || result.error || 'Failed to submit order'}`);\n        }\n    };\n\n    const handleApplyRiskCalculation = (shares: number, stop: number, target: number) => {\n        setQuantity(shares);\n        setStopLossPrice(stop);\n        setTakeProfitPrice(target);\n        setUseBracketOrder(true);\n        setActiveTab('advanced');\n    };\n\n    const estimatedCost = orderType === 'market' ? currentPrice * quantity : limitPrice * quantity;\n    const buyingPower = account ? parseFloat(account.buying_power) : 0;\n    const equity = account ? parseFloat(account.equity) : 100000; // Default for risk calc if loading\n\n    return (\n        <div className=\"bg-[#161b22] border border-gray-800 rounded-3xl p-6\">\n            <h2 className=\"text-xl font-bold mb-4\">Trade {symbol}</h2>\n\n            {/* Styles */}\n            <style>{`\n                .order-tab:hover, .order-type-btn:hover {\n                    color: white !important;\n                    background-color: rgba(255, 255, 255, 0.05);\n                }\n                .order-tab-active, .order-type-active {\n                    background: linear-gradient(to bottom, #4f46e5, #4338ca) !important;\n                    box-shadow: 0 4px 6px -1px rgba(67, 56, 202, 0.3), 0 2px 4px -1px rgba(67, 56, 202, 0.15);\n                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n                    color: white !important;\n                }\n                .buy-btn {\n                    background: linear-gradient(to bottom, #16a34a, #15803d) !important;\n                    box-shadow: 0 4px 6px -1px rgba(22, 163, 74, 0.3), 0 2px 4px -1px rgba(22, 163, 74, 0.15);\n                    transition: all 0.2s;\n                }\n                .buy-btn:hover {\n                    background: linear-gradient(to bottom, #15803d, #166534) !important;\n                    transform: translateY(-1px);\n                    box-shadow: 0 6px 8px -1px rgba(22, 163, 74, 0.4), 0 4px 6px -1px rgba(22, 163, 74, 0.2);\n                }\n                .sell-btn {\n                    background: linear-gradient(to bottom, #dc2626, #b91c1c) !important;\n                    box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.3), 0 2px 4px -1px rgba(220, 38, 38, 0.15);\n                    transition: all 0.2s;\n                }\n                .sell-btn:hover {\n                    background: linear-gradient(to bottom, #b91c1c, #991b1b) !important;\n                    transform: translateY(-1px);\n                    box-shadow: 0 6px 8px -1px rgba(220, 38, 38, 0.4), 0 4px 6px -1px rgba(220, 38, 38, 0.2);\n                }\n                .input-focus-effect:focus {\n                    border-color: #4f46e5 !important;\n                    box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2) !important;\n                    outline: none;\n                }\n            `}</style>\n\n            {/* Tabs */}\n            <div role=\"tablist\" style={{\n                display: 'flex', gap: '0.5rem', marginBottom: '1.5rem',\n                backgroundColor: '#0d1117', padding: '0.25rem', borderRadius: '0.75rem', border: '1px solid #30363d'\n            }}>\n                <button\n                    role=\"tab\"\n                    aria-selected={activeTab === 'simple'}\n                    onClick={() => setActiveTab('simple')}\n                    className={activeTab === 'simple' ? 'order-tab-active' : 'order-tab'}\n                    style={{\n                        flex: 1, padding: '0.625rem 0', borderRadius: '0.5rem', fontSize: '0.875rem', fontWeight: 600,\n                        transition: 'all 0.2s', color: activeTab === 'simple' ? 'white' : '#8b949e',\n                        backgroundColor: activeTab === 'simple' ? '#4f46e5' : 'transparent', border: 'none', cursor: 'pointer'\n                    }}\n                >\n                    Simple\n                </button>\n                <button\n                    role=\"tab\"\n                    aria-selected={activeTab === 'advanced'}\n                    onClick={() => setActiveTab('advanced')}\n                    className={activeTab === 'advanced' ? 'order-tab-active' : 'order-tab'}\n                    style={{\n                        flex: 1, padding: '0.625rem 0', borderRadius: '0.5rem', fontSize: '0.875rem', fontWeight: 600,\n                        transition: 'all 0.2s', color: activeTab === 'advanced' ? 'white' : '#8b949e',\n                        backgroundColor: activeTab === 'advanced' ? '#4f46e5' : 'transparent', border: 'none', cursor: 'pointer',\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.375rem'\n                    }}\n                >\n                    <Settings className=\"w-4 h-4\" />\n                    Advanced\n                </button>\n            </div>\n\n            <form onSubmit={handleSubmit}>\n                {/* Order Type */}\n                <div style={{ marginBottom: '1.25rem' }}>\n                    <label className=\"text-xs text-gray-400 block mb-2 font-semibold uppercase tracking-wider\">Order Type</label>\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.625rem' }}>\n                        <button\n                            type=\"button\"\n                            onClick={() => setOrderType('market')}\n                            className={orderType === 'market' ? 'order-type-active' : 'order-type-btn'}\n                            style={{\n                                padding: '0.625rem 1rem', borderRadius: '0.5rem', fontWeight: 600, fontSize: '0.875rem',\n                                transition: 'all 0.2s', color: orderType === 'market' ? 'white' : '#8b949e',\n                                backgroundColor: orderType === 'market' ? '#4f46e5' : '#0d1117',\n                                border: orderType === 'market' ? 'none' : '1px solid #30363d', cursor: 'pointer'\n                            }}\n                        >\n                            Market\n                        </button>\n                        <button\n                            type=\"button\"\n                            onClick={() => setOrderType('limit')}\n                            className={orderType === 'limit' ? 'order-type-active' : 'order-type-btn'}\n                            style={{\n                                padding: '0.625rem 1rem', borderRadius: '0.5rem', fontWeight: 600, fontSize: '0.875rem',\n                                transition: 'all 0.2s', color: orderType === 'limit' ? 'white' : '#8b949e',\n                                backgroundColor: orderType === 'limit' ? '#4f46e5' : '#0d1117',\n                                border: orderType === 'limit' ? 'none' : '1px solid #30363d', cursor: 'pointer'\n                            }}\n                        >\n                            Limit\n                        </button>\n                    </div>\n                </div>\n\n                {/* Quantity */}\n                <div style={{ marginBottom: '1.25rem' }}>\n                    <label htmlFor=\"quantity\" className=\"text-xs text-gray-400 block mb-2 font-semibold uppercase tracking-wider\">Quantity</label>\n                    <input\n                        id=\"quantity\"\n                        type=\"number\"\n                        value={quantity}\n                        onChange={(e) => setQuantity(Math.max(1, parseInt(e.target.value) || 1))}\n                        min=\"1\"\n                        className=\"input-focus-effect w-full bg-[#0d1117] border border-[#30363d] rounded-lg p-2.5 text-sm text-white font-medium transition-all\"\n                        required\n                    />\n                </div>\n\n                {/* Limit Price Input */}\n                {orderType === 'limit' && (\n                    <div style={{ marginBottom: '1.25rem' }}>\n                        <label htmlFor=\"limitPrice\" className=\"text-xs text-gray-400 block mb-2 font-semibold uppercase tracking-wider\">Limit Price</label>\n                        <input\n                            id=\"limitPrice\"\n                            type=\"number\"\n                            value={limitPrice}\n                            onChange={(e) => setLimitPrice(parseFloat(e.target.value) || 0)}\n                            step=\"0.01\"\n                            className=\"input-focus-effect w-full bg-[#0d1117] border border-[#30363d] rounded-lg p-2.5 text-sm text-white font-medium transition-all\"\n                            required\n                        />\n                    </div>\n                )}\n\n                {/* Advanced Options (Bracket + Risk Calc) */}\n                {activeTab === 'advanced' && (\n                    <div className=\"mb-4 mt-4 bg-gray-900/50 border border-gray-800 rounded-lg p-4\">\n                        <div className=\"flex items-center gap-2 mb-3\">\n                            <input\n                                type=\"checkbox\"\n                                id=\"bracketOrder\"\n                                checked={useBracketOrder}\n                                onChange={(e) => setUseBracketOrder(e.target.checked)}\n                                className=\"w-4 h-4 accent-indigo-600 cursor-pointer\"\n                            />\n                            <label htmlFor=\"bracketOrder\" className=\"text-sm font-bold text-gray-300 cursor-pointer\">\n                                Enable Bracket Order\n                            </label>\n                        </div>\n\n                        {useBracketOrder && (\n                            <div className=\"flex flex-col gap-3\">\n                                <div>\n                                    <label className=\"text-xs text-gray-400 block mb-1\">Stop-Loss Price</label>\n                                    <input\n                                        type=\"number\"\n                                        value={stopLossPrice}\n                                        onChange={(e) => setStopLossPrice(parseFloat(e.target.value) || 0)}\n                                        step=\"0.01\"\n                                        className=\"input-focus-effect w-full bg-gray-900 border border-red-900/50 rounded p-2 text-sm text-white\"\n                                        placeholder=\"Stop price\"\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"text-xs text-gray-400 block mb-1\">Take-Profit Price</label>\n                                    <input\n                                        type=\"number\"\n                                        value={takeProfitPrice}\n                                        onChange={(e) => setTakeProfitPrice(parseFloat(e.target.value) || 0)}\n                                        step=\"0.01\"\n                                        className=\"input-focus-effect w-full bg-gray-900 border border-green-900/50 rounded p-2 text-sm text-white\"\n                                        placeholder=\"Target price\"\n                                    />\n                                </div>\n                            </div>\n                        )}\n\n                        <div className=\"mt-4 pt-4 border-t border-gray-800\">\n                            <RiskCalculator\n                                currentPrice={currentPrice}\n                                accountValue={equity}\n                                buyingPower={buyingPower}\n                                onApplyToOrder={handleApplyRiskCalculation}\n                            />\n                        </div>\n                    </div>\n                )}\n\n                {/* Estimated Cost & Buying Power */}\n                <div className=\"mb-6 bg-[#0d1117] rounded-xl p-4 border border-[#30363d]\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                        <span className=\"text-xs text-gray-400 font-medium\">Estimated Cost</span>\n                        <span className=\"text-lg font-bold text-white\">${estimatedCost.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                        <span className=\"text-xs text-gray-400 font-medium\">Buying Power</span>\n                        <span className=\"text-sm text-gray-300 font-mono\">${buyingPower.toFixed(2)}</span>\n                    </div>\n                </div>\n\n                {/* Current Position Display */}\n                {position && (\n                    <div className=\"mb-6 bg-slate-800/30 border border-slate-600/40 rounded-xl p-4\">\n                        <div className=\"text-[11px] text-gray-400 mb-2 font-semibold uppercase tracking-wider\">Current Position</div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-200 font-medium\">\n                                {position.qty} shares @ ${parseFloat(position.avg_entry_price).toFixed(2)}\n                            </span>\n                            <span className={`text-sm font-bold ${parseFloat(position.unrealized_pl) >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                                {parseFloat(position.unrealized_pl) >= 0 ? '+' : ''}${parseFloat(position.unrealized_pl).toFixed(2)}\n                            </span>\n                        </div>\n                    </div>\n                )}\n\n                {/* Submit Buttons */}\n                <div className=\"grid grid-cols-2 gap-3 mb-6\">\n                    <button\n                        type=\"submit\"\n                        onClick={() => setSide('buy')}\n                        disabled={submitting}\n                        className=\"buy-btn flex items-center justify-center gap-2 p-3.5 rounded-xl text-white font-bold text-base disabled:opacity-70 disabled:cursor-not-allowed\"\n                    >\n                        {submitting && side === 'buy' ? 'Submitting...' : <><TrendingUp size={20} /> Buy</>}\n                    </button>\n                    <button\n                        type=\"submit\"\n                        onClick={() => setSide('sell')}\n                        disabled={submitting}\n                        className=\"sell-btn flex items-center justify-center gap-2 p-3.5 rounded-xl text-white font-bold text-base disabled:opacity-70 disabled:cursor-not-allowed\"\n                    >\n                        {submitting && side === 'sell' ? 'Submitting...' : <><TrendingDown size={20} /> Sell</>}\n                    </button>\n                </div>\n\n                {/* Message */}\n                {message && (\n                    <div className={`p-3 rounded-lg text-sm ${message.toLowerCase().includes('error') || message.toLowerCase().includes('failed')\n                        ? 'bg-red-500/20 border border-red-500/50 text-red-300'\n                        : 'bg-green-500/20 border border-green-500/50 text-green-300'\n                        }`}>\n                        {message}\n                    </div>\n                )}\n            </form>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/AnnouncementBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/AssetCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Info"},"fix":{"range":[88,93],"text":""},"desc":"Remove unused variable \"Info\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport { Info, TrendingUp, TrendingDown, AlertCircle, Maximize2, Target, ChevronDown, ChevronUp } from 'lucide-react';\nimport { StackedEdgeResult } from '@/lib/stackedEdge';\nimport { useMarketData } from '@/hooks/useMarketData';\nimport MarketChart from './MarketChart';\nimport WatchlistButton from './WatchlistButton';\nimport BracketOrderForm from './BracketOrderForm';\n\ninterface AssetCardProps {\n    symbol: string;\n    name: string;\n    assetClass: string;\n}\n\nexport default function AssetCard({ symbol, name, assetClass }: AssetCardProps) {\n    // UI State\n    const [showDetails, setShowDetails] = useState(false);\n    const [showBracketForm, setShowBracketForm] = useState(false);\n\n    // Data Fetching Hook\n    const { data, loading, error } = useMarketData(symbol, assetClass, {\n        pollInterval: 60000,\n        stackedEdge: true,\n        interval: '240' // 4h timeframe for analysis\n    });\n\n    if (loading) return (\n        <div className=\"relative overflow-hidden rounded-xl border border-gray-800 bg-gray-900/50 p-5 h-64 animate-pulse\">\n            <div className=\"flex justify-between items-start mb-4\">\n                <div className=\"flex-1\">\n                    <div className=\"h-6 w-32 bg-gray-800 rounded mb-2\"></div>\n                    <div className=\"h-4 w-16 bg-gray-800 rounded\"></div>\n                </div>\n                <div className=\"h-5 w-16 bg-gray-800 rounded-full\"></div>\n            </div>\n\n            <div className=\"flex-1 bg-gray-800/50 rounded-lg mb-4 h-24\"></div>\n\n            <div className=\"flex justify-between items-end mt-auto\">\n                <div>\n                    <div className=\"h-8 w-24 bg-gray-800 rounded mb-1\"></div>\n                    <div className=\"h-4 w-20 bg-gray-800 rounded\"></div>\n                </div>\n                <div className=\"flex flex-col items-end gap-1\">\n                    <div className=\"h-5 w-16 bg-gray-800 rounded\"></div>\n                    <div className=\"h-3 w-12 bg-gray-800 rounded\"></div>\n                </div>\n            </div>\n        </div>\n    );\n\n    if (error) return (\n        <div className=\"relative overflow-hidden rounded-xl border border-red-900/30 bg-gray-900/50 p-5 h-64 flex items-center justify-center\">\n            <div className=\"text-center text-red-400\">\n                <AlertCircle className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                <p className=\"text-sm font-medium\">Failed to load data</p>\n                <p className=\"text-xs opacity-70 mt-1\">{symbol}</p>\n            </div>\n        </div>\n    );\n\n    const se: StackedEdgeResult = data?.stackedEdge;\n    const isHighBull = se?.netBias === 'Bullish' && se?.bullishScore >= 6;\n    const isHighBear = se?.netBias === 'Bearish' && se?.bearishScore >= 6;\n\n    // Dynamic styles based on sentiment\n    const containerStyle: React.CSSProperties = {\n        position: 'relative',\n        overflow: 'hidden',\n        transition: 'all 0.3s ease',\n        backgroundColor: 'rgba(13, 17, 23, 0.6)',\n        backdropFilter: 'blur(12px)',\n        borderRadius: '0.75rem',\n        padding: '1.25rem',\n        border: '1px solid #30363d',\n        boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'\n    };\n\n    if (isHighBull) {\n        containerStyle.border = '1px solid rgba(34, 197, 94, 0.5)';\n        containerStyle.boxShadow = '0 0 15px rgba(34, 197, 94, 0.2), inset 0 0 20px rgba(34, 197, 94, 0.05)';\n    } else if (isHighBear) {\n        containerStyle.border = '1px solid rgba(239, 68, 68, 0.5)';\n        containerStyle.boxShadow = '0 0 15px rgba(239, 68, 68, 0.2), inset 0 0 20px rgba(239, 68, 68, 0.05)';\n    }\n\n    const getScoreBadgeStyle = () => {\n        const baseStyle = {\n            fontSize: '0.625rem',\n            fontWeight: 600,\n            padding: '0.125rem 0.5rem',\n            borderRadius: '0.375rem',\n            border: '1px solid',\n            cursor: 'pointer',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '0.25rem',\n            transition: 'all 0.2s',\n        };\n\n        if (se?.netBias === 'Bullish') {\n            if (se.bullishScore >= 6) return { ...baseStyle, color: '#4ade80', borderColor: 'rgba(74, 222, 128, 0.3)', backgroundColor: 'rgba(74, 222, 128, 0.1)' };\n            if (se.bullishScore >= 4) return { ...baseStyle, color: '#facc15', borderColor: 'rgba(250, 204, 21, 0.3)', backgroundColor: 'rgba(250, 204, 21, 0.1)' };\n        } else if (se?.netBias === 'Bearish') {\n            if (se.bearishScore >= 6) return { ...baseStyle, color: '#f87171', borderColor: 'rgba(248, 113, 113, 0.3)', backgroundColor: 'rgba(248, 113, 113, 0.1)' };\n            if (se.bearishScore >= 4) return { ...baseStyle, color: '#facc15', borderColor: 'rgba(250, 204, 21, 0.3)', backgroundColor: 'rgba(250, 204, 21, 0.1)' };\n        }\n        return { ...baseStyle, color: '#9ca3af', borderColor: 'rgba(156, 163, 175, 0.3)', backgroundColor: 'rgba(156, 163, 175, 0.1)' };\n    };\n\n    return (\n        <div style={containerStyle} className=\"group hover:border-gray-500/50\">\n            {/* Full Screen Link - Top Right Corner */}\n            <Link\n                href={`/asset/${symbol}?assetClass=${assetClass}&name=${encodeURIComponent(name)}`}\n                className=\"absolute top-3 right-3 p-1.5 bg-[#1f2937]/90 backdrop-blur-md rounded-lg text-gray-400 border border-gray-700/50 z-40 opacity-0 group-hover:opacity-100 hover:bg-blue-600/20 hover:text-blue-400 hover:border-blue-500/50 transition-all duration-300 shadow-xl\"\n                style={{\n                    position: 'absolute',\n                    top: '0.75rem',\n                    right: '0.75rem',\n                    zIndex: 40\n                }}\n                title=\"Full Page Analysis\"\n            >\n                <Maximize2 className=\"w-4 h-4\" />\n            </Link>\n\n            {/* Watchlist Star */}\n            <div className=\"absolute top-3 right-14 z-50 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-1 group-hover:translate-y-0\">\n                <WatchlistButton symbol={symbol} />\n            </div>\n\n            {/* Signal Badge */}\n            {(isHighBull || isHighBear) && (\n                <div className=\"absolute top-0 left-0 z-20\">\n                    <div style={{\n                        background: isHighBull ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 'linear-gradient(135deg, #ef4444, #dc2626)',\n                        color: 'white',\n                        fontSize: '9px',\n                        fontWeight: 800,\n                        padding: '0.125rem 0.75rem',\n                        borderBottomRightRadius: '0.75rem',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        letterSpacing: '0.05em'\n                    }}>\n                        {isHighBull ? 'STRONG LONG' : 'STRONG SHORT'}\n                    </div>\n                </div>\n            )}\n\n            {/* Header */}\n            <div className=\"flex justify-between items-start mb-4\">\n                <div>\n                    <h2 className=\"text-xl font-bold flex items-center gap-2 text-white\">\n                        {name}\n                        {isHighBull && <TrendingUp className=\"w-5 h-5 text-green-400\" />}\n                        {isHighBear && <TrendingDown className=\"w-5 h-5 text-red-400\" />}\n                    </h2>\n                    <p className=\"text-sm text-gray-400 font-medium\">{symbol}</p>\n                </div>\n                <div className=\"flex flex-col items-end gap-1.5\">\n                    <span className=\"text-[10px] px-2 py-0.5 bg-gray-800/40 rounded-full uppercase text-gray-300 border border-gray-700/40\">\n                        {assetClass}\n                    </span>\n                    {se && (\n                        <div\n                            style={getScoreBadgeStyle()}\n                            onClick={(e) => {\n                                e.stopPropagation();\n                                setShowDetails(!showDetails);\n                            }}\n                            className=\"hover:scale-105 active:scale-95 shadow-sm\"\n                        >\n                            {se.netBias} {se.netBias === 'Bullish' ? se.bullishScore : se.bearishScore}/{se.maxScore}\n                            {showDetails ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            <MarketChart symbol={symbol} assetClass={assetClass} />\n\n            {/* Price Info */}\n            <div className=\"mt-4 flex justify-between items-end\">\n                <div>\n                    <span className=\"text-2xl font-bold text-white tracking-tight\">${data?.price?.toFixed(2) || '---'}</span>\n                    <div className={`text-sm font-semibold flex items-center gap-1 ${data?.change >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                        {data?.change >= 0 ? '+' : ''}{data?.change?.toFixed(2)} ({data?.changePercent?.toFixed(2)}%)\n                    </div>\n                </div>\n                {se && (\n                    <div className=\"flex flex-col items-end\">\n                        <span style={{\n                            fontSize: '0.65rem',\n                            fontWeight: 700,\n                            textTransform: 'uppercase',\n                            letterSpacing: '0.05em',\n                            padding: '0.125rem 0.5rem',\n                            borderRadius: '0.25rem',\n                            backgroundColor: se.phase === 'Confirmation' ? 'rgba(34, 197, 94, 0.1)' : 'rgba(55, 65, 81, 0.3)',\n                            color: se.phase === 'Confirmation' ? '#4ade80' : '#9ca3af',\n                            border: se.phase === 'Confirmation' ? '1px solid rgba(34, 197, 94, 0.2)' : '1px solid rgba(75, 85, 99, 0.2)'\n                        }}>\n                            {se.phase}\n                        </span>\n                        <span className=\"text-[9px] text-gray-500 mt-1 font-medium\">4H Timeframe</span>\n                    </div>\n                )}\n            </div>\n\n            {/* Confluence Alert */}\n            {(isHighBull || isHighBear) && (\n                <div style={{\n                    marginTop: '0.75rem',\n                    padding: '0.5rem 0.75rem',\n                    borderRadius: '0.5rem',\n                    fontSize: '0.7rem',\n                    display: 'flex',\n                    alignItems: 'start',\n                    gap: '0.5rem',\n                    backgroundColor: isHighBull ? 'rgba(34, 197, 94, 0.05)' : 'rgba(239, 68, 68, 0.05)',\n                    border: isHighBull ? '1px solid rgba(34, 197, 94, 0.15)' : '1px solid rgba(239, 68, 68, 0.15)',\n                    color: isHighBull ? '#86efac' : '#fca5a5'\n                }}>\n                    <AlertCircle className=\"w-3.5 h-3.5 shrink-0 mt-0.5\" />\n                    <span className=\"leading-tight\">\n                        {isHighBull\n                            ? \"High Confluence: Trend, volume, and momentum alignment.\"\n                            : \"High Prob Setup: Indicators signal potential breakdown.\"}\n                    </span>\n                </div>\n            )}\n\n            {/* Detailed Analytics */}\n            {showDetails && se && (\n                <div className=\"mt-4 pt-3 border-t border-gray-700/50 space-y-2 animate-in fade-in slide-in-from-top-1 bg-black/20 -mx-5 px-5 pb-2\">\n                    <h3 className=\"text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 mt-2\">Signal Matrix</h3>\n                    <div className=\"grid grid-cols-1 gap-1.5\">\n                        {se.indicators.map((ind, idx) => (\n                            <div key={idx} className=\"flex justify-between items-center text-xs p-1.5 rounded bg-gray-800/40 border border-gray-700/30\">\n                                <div className=\"flex flex-col\">\n                                    <span className=\"font-medium text-gray-300\">{ind.name}</span>\n                                    <span className=\"text-[9px] text-gray-500\">{ind.category}</span>\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                    <span className=\"text-gray-400 font-mono\">{ind.value}</span>\n                                    <span style={{\n                                        fontSize: '0.65rem',\n                                        padding: '0.125rem 0.375rem',\n                                        borderRadius: '0.25rem',\n                                        fontWeight: 600,\n                                        backgroundColor: ind.side === 'Bullish' ? 'rgba(34, 197, 94, 0.1)' : ind.side === 'Bearish' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(107, 114, 128, 0.1)',\n                                        color: ind.side === 'Bullish' ? '#4ade80' : ind.side === 'Bearish' ? '#f87171' : '#9ca3af'\n                                    }}>\n                                        {ind.side}\n                                    </span>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"mt-4 pt-4 border-t border-gray-700/50 flex gap-2\">\n                <button\n                    onClick={() => setShowBracketForm(true)}\n                    className=\"flex-1 hover:bg-indigo-600/30 hover:border-indigo-400/60 text-xs font-bold py-2.5 px-3 rounded-lg transition-all flex items-center justify-center gap-2 shadow-sm active:scale-[0.98] border border-indigo-500/40 text-indigo-300 bg-indigo-900/20\"\n                >\n                    <Target className=\"w-3.5 h-3.5\" />\n                    Smart Entry\n                </button>\n                <button\n                    onClick={() => setShowDetails(!showDetails)}\n                    className=\"px-3 py-2.5 rounded-lg hover:bg-gray-700/50 hover:text-white hover:border-gray-500 transition-all active:scale-[0.98] bg-gray-800/30 border border-gray-700/40 text-gray-400\"\n                    title={showDetails ? \"Hide Details\" : \"Show Details\"}\n                >\n                    {showDetails ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                </button>\n            </div>\n\n            {/* Bracket Order Modal */}\n            {showBracketForm && (\n                <BracketOrderForm\n                    symbol={symbol}\n                    currentPrice={data?.price || 0}\n                    onClose={() => setShowBracketForm(false)}\n                    onSuccess={() => {\n                        setShowBracketForm(false);\n                    }}\n                />\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/AssetGridSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/BracketOrderForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/ClientShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/CommandPalette.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/CountrySelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/CurrencyDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/DashboardWatchlist.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":19,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n    children: ReactNode;\n    fallback?: ReactNode;\n}\n\ninterface State {\n    hasError: boolean;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n    public state: State = {\n        hasError: false\n    };\n\n    public static getDerivedStateFromError(_: Error): State {\n        return { hasError: true };\n    }\n\n    public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n        console.error('Uncaught error:', error, errorInfo);\n    }\n\n    public render() {\n        if (this.state.hasError) {\n            return this.props.fallback || (\n                <div className=\"p-4 rounded-lg bg-red-500/10 border border-red-500/20 text-center\">\n                    <h3 className=\"text-red-400 font-bold mb-1\">Something went wrong</h3>\n                    <p className=\"text-xs text-gray-400\">Unable to load this section</p>\n                </div>\n            );\n        }\n\n        return this.props.children;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/MarketChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/MobileNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/NotificationBell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/PortfolioAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[69,80],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalytics'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAnalytics]","fix":{"range":[783,785],"text":"[fetchAnalytics]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { TrendingUp, TrendingDown, BarChart3, DollarSign, Target, Shield } from 'lucide-react';\nimport { PerformanceMetrics, Trade } from '@/lib/trading/analytics';\n\ninterface AnalyticsProps {\n    className?: string;\n}\n\nexport default function PortfolioAnalytics({ className = '' }: AnalyticsProps) {\n    interface AnalyticsResponse {\n        metrics?: PerformanceMetrics;\n        recentTrades?: Trade[];\n    }\n\n    const [data, setData] = useState<AnalyticsResponse | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        fetchAnalytics();\n        const interval = setInterval(fetchAnalytics, 30000); // Refresh every 30 seconds\n        return () => clearInterval(interval);\n    }, []);\n\n    const fetchAnalytics = async () => {\n        try {\n            const res = await fetch('/api/trading/analytics');\n            const json: AnalyticsResponse = await res.json(); // Cast to AnalyticsResponse\n            if (json) { // Assuming success is implied by data presence or handled by API\n                setData(json);\n            }\n        } catch (error) {\n            console.error('Error fetching analytics:', error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className={`bg-[#161b22] border border-gray-800 rounded-2xl p-8 ${className}`}>\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-6 bg-gray-800 rounded w-1/4\"></div>\n                    <div className=\"space-y-3\">\n                        <div className=\"h-20 bg-gray-800 rounded\"></div>\n                        <div className=\"h-20 bg-gray-800 rounded\"></div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    const metrics = data?.metrics;\n\n    return (\n        <div className={`bg-[#161b22] border border-gray-800 rounded-2xl p-6 ${className}`}>\n            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2\">\n                <BarChart3 className=\"w-6 h-6 text-indigo-400\" />\n                Portfolio Analytics\n            </h2>\n\n            {/* Performance Metrics Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n                {/* Total Return */}\n                <div className=\"bg-gray-900/60 border border-gray-800 rounded-xl p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-gray-400 uppercase tracking-wide\">Total Return</span>\n                        <DollarSign className=\"w-4 h-4 text-gray-600\" />\n                    </div>\n                    <div className={`text-2xl font-bold mb-1 ${metrics?.totalReturn && metrics.totalReturn >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                        {metrics?.totalReturn && metrics.totalReturn >= 0 ? '+' : ''}${metrics?.totalReturn?.toFixed(2) || '0.00'}\n                    </div>\n                    <div className={`text-sm ${metrics?.totalReturnPercent && metrics.totalReturnPercent >= 0 ? 'text-green-500' : 'text-red-500'}`}>\n                        {metrics?.totalReturnPercent && metrics.totalReturnPercent >= 0 ? '+' : ''}{metrics?.totalReturnPercent?.toFixed(2) || '0.00'}%\n                    </div>\n                </div>\n\n                {/* Sharpe Ratio */}\n                <div className=\"bg-gray-900/60 border border-gray-800 rounded-xl p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-gray-400 uppercase tracking-wide\">Sharpe Ratio</span>\n                        <Target className=\"w-4 h-4 text-gray-600\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-indigo-400 mb-1\">\n                        {metrics?.sharpeRatio?.toFixed(2) || '0.00'}\n                    </div>\n                    <div className=\"text-xs text-gray-500\">\n                        {(metrics?.sharpeRatio || 0) > 1 ? 'Good' : (metrics?.sharpeRatio || 0) > 2 ? 'Excellent' : 'Fair'} risk-adjusted returns\n                    </div>\n                </div>\n\n                {/* Max Drawdown */}\n                <div className=\"bg-gray-900/60 border border-gray-800 rounded-xl p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-gray-400 uppercase tracking-wide\">Max Drawdown</span>\n                        <TrendingDown className=\"w-4 h-4 text-gray-600\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-400 mb-1\">\n                        -{metrics?.maxDrawdownPercent?.toFixed(2) || '0.00'}%\n                    </div>\n                    <div className=\"text-xs text-gray-500\">\n                        -${metrics?.maxDrawdown?.toFixed(2) || '0.00'}\n                    </div>\n                </div>\n\n                {/* Win Rate */}\n                <div className=\"bg-gray-900/60 border border-gray-800 rounded-xl p-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-gray-400 uppercase tracking-wide\">Win Rate</span>\n                        <Shield className=\"w-4 h-4 text-gray-600\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-green-400 mb-1\">\n                        {metrics?.winRate?.toFixed(1) || '0.0'}%\n                    </div>\n                    <div className=\"text-xs text-gray-500\">\n                        {metrics?.winningTrades || 0}W / {metrics?.losingTrades || 0}L\n                    </div>\n                </div>\n            </div>\n\n            {/* Trade Statistics */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {/* Statistics */}\n                <div className=\"bg-gray-900/40 border border-gray-800 rounded-xl p-4\">\n                    <h3 className=\"text-sm font-bold text-gray-300 mb-4 uppercase tracking-wide\">Trade Statistics</h3>\n                    <div className=\"space-y-3\">\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Total Trades</span>\n                            <span className=\"text-sm font-bold text-white\">{metrics?.totalTrades || 0}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Average Win</span>\n                            <span className=\"text-sm font-bold text-green-400\">+${metrics?.avgWin?.toFixed(2) || '0.00'}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Average Loss</span>\n                            <span className=\"text-sm font-bold text-red-400\">-${metrics?.avgLoss?.toFixed(2) || '0.00'}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Profit Factor</span>\n                            <span className=\"text-sm font-bold text-indigo-400\">\n                                {metrics?.profitFactor === Infinity ? '∞' : metrics?.profitFactor?.toFixed(2) || '0.00'}\n                            </span>\n                        </div>\n                        <div className=\"flex justify-between items-center border-t border-gray-800 pt-3\">\n                            <span className=\"text-sm text-gray-400\">Expectancy</span>\n                            <span className={`text-sm font-bold ${metrics?.expectancy && metrics.expectancy >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                                ${metrics?.expectancy?.toFixed(2) || '0.00'}\n                            </span>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Equity Summary */}\n                <div className=\"bg-gray-900/40 border border-gray-800 rounded-xl p-4\">\n                    <h3 className=\"text-sm font-bold text-gray-300 mb-4 uppercase tracking-wide\">Account Summary</h3>\n                    <div className=\"space-y-3\">\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Starting Equity</span>\n                            <span className=\"text-sm font-bold text-white\">${metrics?.initialEquity?.toLocaleString() || '0'}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Current Equity</span>\n                            <span className=\"text-sm font-bold text-white\">${metrics?.currentEquity?.toLocaleString() || '0'}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-400\">Unrealized P&L</span>\n                            <span className={`text-sm font-bold ${metrics?.unrealizedPL && metrics.unrealizedPL >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                                {metrics?.unrealizedPL && metrics.unrealizedPL >= 0 ? '+' : ''}${metrics?.unrealizedPL?.toFixed(2) || '0.00'}\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Recent Trades */}\n            {data?.recentTrades && data.recentTrades.length > 0 && (\n                <div className=\"mt-6\">\n                    <h3 className=\"text-sm font-bold text-gray-300 mb-3 uppercase tracking-wide\">Recent Trades</h3>\n                    <div className=\"bg-gray-900/40 border border-gray-800 rounded-xl overflow-hidden\">\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead className=\"bg-gray-900/60\">\n                                    <tr className=\"text-left text-xs text-gray-400 uppercase tracking-wider\">\n                                        <th className=\"px-4 py-3\">Symbol</th>\n                                        <th className=\"px-4 py-3\">Side</th>\n                                        <th className=\"px-4 py-3\">Qty</th>\n                                        <th className=\"px-4 py-3\">Price</th>\n                                        <th className=\"px-4 py-3\">Date</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-gray-800\">\n                                    {data.recentTrades.map((trade) => (\n                                        <tr key={trade.id} className=\"text-sm\">\n                                            <td className=\"px-4 py-3 font-bold text-white\">{trade.symbol}</td>\n                                            <td className=\"px-4 py-3\">\n                                                <span className={`px-2 py-1 rounded text-xs font-bold ${trade.side === 'buy' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'\n                                                    }`}>\n                                                    {trade.side?.toUpperCase() ?? '—'}\n                                                </span>\n                                            </td>\n                                            <td className=\"px-4 py-3 text-gray-300\">{trade.qty ?? '—'}</td>\n                                            <td className={`px-4 py-3 font-medium ${trade.side === 'buy' || trade.side === 'LONG' ? 'text-green-400' : 'text-red-400'}`}>\n                                                {trade.side}\n                                            </td>\n                                            <td className=\"px-4 py-3 font-mono text-gray-300\">\n                                                ${(trade.filled_avg_price || trade.entryPrice)?.toFixed(2) ?? '—'}\n                                            </td>\n                                            <td className=\"px-4 py-3 text-gray-400 text-xs\">\n                                                {(trade.filled_at || trade.entryTime)\n                                                    ? new Date(trade.filled_at || trade.entryTime).toLocaleDateString()\n                                                    : '—'}\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/PortfolioDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Account' is defined but never used.","line":6,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Account"},"fix":{"range":[202,211],"text":""},"desc":"Remove unused variable \"Account\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { DollarSign, TrendingUp, Wallet, PieChart } from 'lucide-react';\nimport TrailingStopForm from './TrailingStopForm';\nimport { useAccount, Position, Account } from '@/hooks/useAccount';\nimport Link from 'next/link';\n\nexport default function PortfolioDashboard({ compact = false }: { compact?: boolean }) {\n    // Hook State\n    const { account, positions, loading, error, refetch } = useAccount({\n        pollInterval: 5000,\n        fetchPositions: true\n    });\n\n    // Local State\n    const [selectedPosition, setSelectedPosition] = useState<Position | null>(null);\n\n    const handleClosePosition = async (symbol: string) => {\n        if (!confirm(`Are you sure you want to close ${symbol}?`)) {\n            return;\n        }\n\n        try {\n            const res = await fetch(`/api/trading/positions/${symbol}`, {\n                method: 'DELETE',\n            });\n\n            const data = await res.json();\n\n            if (data.success) {\n                alert(`Position ${symbol} closed successfully`);\n                refetch(); // Refresh data\n            } else {\n                alert(`Error: ${data.error || 'Failed to close position'}`);\n            }\n        } catch (err: unknown) {\n            alert(`Error: ${err instanceof Error ? err.message : 'Unknown error'}`);\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className={compact ? \"p-4 animate-pulse text-gray-400\" : \"flex items-center justify-center min-h-screen\"}>\n                <div className=\"animate-pulse text-gray-400 text-sm\">Loading portfolio...</div>\n            </div>\n        );\n    }\n\n    if (error) {\n        // In compact mode, just return null or minimal error to avoid breaking dashboard layout\n        if (compact) return null;\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"text-red-500\">Error: {error}</div>\n            </div>\n        );\n    }\n\n    const totalPL = positions.reduce((sum, pos) => sum + parseFloat(pos.unrealized_pl), 0);\n    const totalPLPercent = account ?\n        ((parseFloat(account.equity) - parseFloat(account.last_equity || '0')) / parseFloat(account.last_equity || '1') * 100) : 0;\n\n    return (\n        <div className={compact ? \"\" : \"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\"}>\n            {!compact && (\n                <h1 className=\"text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500 mb-8\">\n                    Portfolio\n                </h1>\n            )}\n\n            {/* Account Summary Cards */}\n            {account && (\n                <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ${compact ? '' : 'mb-8'}`}>\n                    <div className=\"bg-gradient-to-br from-gray-800/80 to-gray-900/80 backdrop-blur-sm p-6 rounded-2xl border border-gray-700/50 shadow-xl\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <div className=\"p-2 bg-blue-500/10 rounded-lg\">\n                                <DollarSign className=\"w-5 h-5 text-blue-400\" />\n                            </div>\n                            <span className=\"text-sm text-gray-400 font-semibold uppercase\">Portfolio Value</span>\n                        </div>\n                        <div className=\"text-3xl font-bold text-white\">\n                            ${parseFloat(account.portfolio_value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                        </div>\n                    </div>\n\n                    <div className=\"bg-gradient-to-br from-gray-800/80 to-gray-900/80 backdrop-blur-sm p-6 rounded-2xl border border-gray-700/50 shadow-xl\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <div className=\"p-2 bg-green-500/10 rounded-lg\">\n                                <Wallet className=\"w-5 h-5 text-green-400\" />\n                            </div>\n                            <span className=\"text-sm text-gray-400 font-semibold uppercase\">Cash</span>\n                        </div>\n                        <div className=\"text-3xl font-bold text-white\">\n                            ${parseFloat(account.cash).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                        </div>\n                    </div>\n\n                    <div className=\"bg-gradient-to-br from-gray-800/80 to-gray-900/80 backdrop-blur-sm p-6 rounded-2xl border border-gray-700/50 shadow-xl\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <div className=\"p-2 bg-purple-500/10 rounded-lg\">\n                                <TrendingUp className=\"w-5 h-5 text-purple-400\" />\n                            </div>\n                            <span className=\"text-sm text-gray-400 font-semibold uppercase\">Total P&L</span>\n                        </div>\n                        <div className={`text-3xl font-bold ${totalPL >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                            {totalPL >= 0 ? '+' : ''}${totalPL.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                        </div>\n                        <div className={`text-sm ${totalPL >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                            {totalPLPercent >= 0 ? '+' : ''}{totalPLPercent.toFixed(2)}%\n                        </div>\n                    </div>\n\n                    <div className=\"bg-gradient-to-br from-gray-800/80 to-gray-900/80 backdrop-blur-sm p-6 rounded-2xl border border-gray-700/50 shadow-xl\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <div className=\"p-2 bg-indigo-500/10 rounded-lg\">\n                                <PieChart className=\"w-5 h-5 text-indigo-400\" />\n                            </div>\n                            <span className=\"text-sm text-gray-400 font-semibold uppercase\">Buying Power</span>\n                        </div>\n                        <div className=\"text-3xl font-bold text-white\">\n                            ${parseFloat(account.buying_power).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Positions Table - Only show if not compact */}\n            {!compact && (\n                <div className=\"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-2xl border border-gray-700/50 overflow-hidden mt-8\">\n                    <div className=\"p-6 border-b border-gray-700/50\">\n                        <h2 className=\"text-2xl font-bold text-white\">Open Positions</h2>\n                        <p className=\"text-gray-400 text-sm mt-1\">{positions.length} position{positions.length !== 1 ? 's' : ''}</p>\n                    </div>\n\n                    {positions.length === 0 ? (\n                        <div className=\"p-12 text-center text-gray-500\">\n                            No open positions. Start trading to see your positions here.\n                        </div>\n                    ) : (\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead className=\"bg-gray-900/50\">\n                                    <tr>\n                                        <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider\">Symbol</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">Qty</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">Avg Price</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">Current Price</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">Market Value</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">P&L</th>\n                                        <th className=\"px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider\">P&L %</th>\n                                        <th className=\"px-6 py-4 text-center text-xs font-bold text-gray-400 uppercase tracking-wider\">Action</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-gray-700/30\">\n                                    {positions.map((position) => {\n                                        const pl = parseFloat(position.unrealized_pl);\n                                        const plpc = parseFloat(position.unrealized_plpc) * 100;\n\n                                        return (\n                                            <tr key={position.symbol} className=\"hover:bg-gray-800/30 transition-colors\">\n                                                <td className=\"px-6 py-4\">\n                                                    <Link href={`/asset/${position.symbol}?assetClass=stock&name=${position.symbol}`} className=\"font-bold text-blue-400 hover:text-blue-300\">\n                                                        {position.symbol}\n                                                    </Link>\n                                                </td>\n                                                <td className=\"px-6 py-4 text-right text-white\">{(position.qty).toLocaleString()}</td>\n                                                <td className=\"px-6 py-4 text-right text-gray-300\">${parseFloat(position.avg_entry_price).toFixed(2)}</td>\n                                                <td className=\"px-6 py-4 text-right text-white font-semibold\">${parseFloat(position.current_price).toFixed(2)}</td>\n                                                <td className=\"px-6 py-4 text-right text-white font-semibold\">${parseFloat(position.market_value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>\n                                                <td className={`px-6 py-4 text-right font-bold ${pl >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                                                    {pl >= 0 ? '+' : ''}${pl.toFixed(2)}\n                                                </td>\n                                                <td className={`px-6 py-4 text-right font-bold ${plpc >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                                                    {plpc >= 0 ? '+' : ''}{plpc.toFixed(2)}%\n                                                </td>\n                                                <td className=\"px-6 py-4 text-center\">\n                                                    <div className=\"flex items-center justify-end gap-2\">\n                                                        <button\n                                                            onClick={() => setSelectedPosition(position)}\n                                                            className=\"px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 text-xs font-bold rounded-lg border border-blue-600/50 transition-colors flex items-center gap-1\"\n                                                        >\n                                                            <TrendingUp className=\"w-3 h-3\" />\n                                                            Trail\n                                                        </button>\n                                                        <button\n                                                            onClick={() => handleClosePosition(position.symbol)}\n                                                            className=\"px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 text-xs font-bold rounded-lg border border-red-600/50 transition-colors\"\n                                                        >\n                                                            Close\n                                                        </button>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        );\n                                    })}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {/* Trailing Stop Modal */}\n            {!compact && selectedPosition && (\n                <TrailingStopForm\n                    symbol={selectedPosition.symbol}\n                    currentPrice={parseFloat(selectedPosition.current_price)}\n                    positionQty={selectedPosition.qty}\n                    onClose={() => setSelectedPosition(null)}\n                    onSuccess={() => {\n                        // Optional: Show success toast\n                        setSelectedPosition(null);\n                        refetch(); // Refresh data using hook\n                    }}\n                />\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/RecentTrades.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/RiskCalculator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/SearchBox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/ThemeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/TradingPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/TrailingStopForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/UpgradeBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/WatchlistButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/WatchlistSelectModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":25,"column":79,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":86}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { X, Check, Loader, Plus, Star } from 'lucide-react';\nimport { useWatchlist } from '@/hooks/useWatchlist';\nimport { useState, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\n\ninterface Watchlist {\n    id: string;\n    name: string;\n    symbols: string[];\n}\n\ninterface WatchlistSelectModalProps {\n    symbol: string;\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nexport default function WatchlistSelectModal({\n    symbol,\n    isOpen,\n    onClose\n}: WatchlistSelectModalProps) {\n    const { watchlists, addToWatchlist, removeFromWatchlist, createWatchlist, loading } = useWatchlist();\n    const [newListName, setNewListName] = useState('');\n    const [isCreating, setIsCreating] = useState(false);\n    const [mounted, setMounted] = useState(false);\n\n    useEffect(() => {\n        setMounted(true);\n        return () => setMounted(false);\n    }, []);\n\n    if (!isOpen || !mounted) return null;\n\n    const handleToggleList = async (watchlistId: string) => {\n        const watchlist = watchlists.find((w: Watchlist) => w.id === watchlistId);\n        if (!watchlist) return;\n\n        try {\n            if (watchlist.symbols.includes(symbol)) {\n                await removeFromWatchlist(watchlistId, symbol);\n            } else {\n                await addToWatchlist(watchlistId, symbol);\n            }\n        } catch (error) {\n            console.error('Toggle failed:', error);\n        }\n    };\n\n    const handleCreateList = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newListName.trim()) return;\n\n        setIsCreating(true);\n        try {\n            await createWatchlist(newListName.trim(), [symbol]);\n            setNewListName('');\n            onClose();\n        } catch (error) {\n            console.error('Create failed:', error);\n        } finally {\n            setIsCreating(false);\n        }\n    };\n\n    return createPortal(\n        <>\n            {/* Backdrop */}\n            <div\n                onClick={onClose}\n                style={{\n                    position: 'fixed',\n                    inset: 0,\n                    backgroundColor: 'rgba(0,0,0,0.65)',\n                    backdropFilter: 'blur(3px)',\n                    zIndex: 9998\n                }}\n            />\n\n            {/* Modal Container */}\n            <div\n                role=\"dialog\"\n                aria-modal=\"true\"\n                onClick={(e) => e.stopPropagation()}\n                style={{\n                    position: 'fixed',\n                    top: '50%',\n                    left: '50%',\n                    transform: 'translate(-50%, -50%)',\n                    width: '420px',\n                    backgroundColor: '#1f2937',\n                    borderRadius: '12px',\n                    boxShadow: '0 25px 60px rgba(0,0,0,0.5)',\n                    overflow: 'hidden',\n                    zIndex: 9999,\n                    display: 'flex',\n                    flexDirection: 'column',\n                    animation: 'fadeIn 0.2s ease'\n                }}\n            >\n\n                {/* Header */}\n                <div style={{\n                    padding: '16px 20px',\n                    borderBottom: '1px solid #2d3748',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <Star size={18} color=\"#3b82f6\" />\n                        <div>\n                            <div style={{ fontWeight: 600, color: '#ffffff' }}>\n                                Add to Watchlist\n                            </div>\n                            <div style={{ fontSize: '12px', color: '#9ca3af' }}>\n                                {symbol}\n                            </div>\n                        </div>\n                    </div>\n\n                    <button\n                        onClick={onClose}\n                        style={{\n                            background: 'none',\n                            border: 'none',\n                            cursor: 'pointer',\n                            color: '#9ca3af'\n                        }}\n                    >\n                        <X size={18} />\n                    </button>\n                </div>\n\n                {/* Body */}\n                <div style={{\n                    padding: '16px 20px',\n                    maxHeight: '250px',\n                    overflowY: 'auto'\n                }}>\n                    {watchlists.length === 0 ? (\n                        <div style={{\n                            textAlign: 'center',\n                            color: '#9ca3af',\n                            padding: '20px 0'\n                        }}>\n                            No watchlists yet.\n                        </div>\n                    ) : (\n                        watchlists.map((watchlist: Watchlist) => {\n                            const isInList = watchlist.symbols.includes(symbol);\n\n                            return (\n                                <div\n                                    key={watchlist.id}\n                                    onClick={() => handleToggleList(watchlist.id)}\n                                    style={{\n                                        padding: '10px 12px',\n                                        borderRadius: '8px',\n                                        marginBottom: '8px',\n                                        backgroundColor: isInList ? '#1e40af' : '#374151',\n                                        color: '#ffffff',\n                                        display: 'flex',\n                                        justifyContent: 'space-between',\n                                        alignItems: 'center',\n                                        cursor: 'pointer',\n                                        transition: '0.2s'\n                                    }}\n                                >\n                                    <span>{watchlist.name}</span>\n                                    {isInList && <Check size={16} />}\n                                </div>\n                            );\n                        })\n                    )}\n                </div>\n\n                {/* Footer / Create */}\n                <form\n                    onSubmit={handleCreateList}\n                    style={{\n                        padding: '16px 20px',\n                        borderTop: '1px solid #2d3748',\n                        display: 'flex',\n                        gap: '8px'\n                    }}\n                >\n                    <input\n                        type=\"text\"\n                        value={newListName}\n                        onChange={(e) => setNewListName(e.target.value)}\n                        placeholder=\"New watchlist name...\"\n                        disabled={isCreating}\n                        style={{\n                            flex: 1,\n                            padding: '8px 10px',\n                            borderRadius: '6px',\n                            border: '1px solid #4b5563',\n                            backgroundColor: '#111827',\n                            color: '#ffffff',\n                            fontSize: '14px'\n                        }}\n                    />\n\n                    <button\n                        type=\"submit\"\n                        disabled={isCreating || !newListName.trim()}\n                        style={{\n                            padding: '8px 14px',\n                            borderRadius: '6px',\n                            border: 'none',\n                            backgroundColor: '#0d6efd',\n                            color: '#ffffff',\n                            fontWeight: 600,\n                            cursor: isCreating || !newListName.trim() ? 'not-allowed' : 'pointer',\n                            opacity: isCreating || !newListName.trim() ? 0.6 : 1,\n                            display: 'flex',\n                            alignItems: 'center',\n                            gap: '6px'\n                        }}\n                    >\n                        {isCreating ? (\n                            <Loader size={14} />\n                        ) : (\n                            <>\n                                <Plus size={14} />\n                                Create\n                            </>\n                        )}\n                    </button>\n                </form>\n            </div>\n        </>,\n        document.body\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/analytics/AnalyticsDashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchJournalData' and 'fetchPerformanceData'. Either include them or remove the dependency array.","line":25,"column":8,"nodeType":"ArrayExpression","endLine":25,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [fetchJournalData, fetchPerformanceData, timeframe]","fix":{"range":[857,868],"text":"[fetchJournalData, fetchPerformanceData, timeframe]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchJournalData'. Either include it or remove the dependency array.","line":29,"column":8,"nodeType":"ArrayExpression","endLine":29,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchJournalData, page]","fix":{"range":[929,935],"text":"[fetchJournalData, page]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport MetricsGrid from './MetricsGrid';\nimport EquityCurveChart from './EquityCurveChart';\nimport TradeJournalTable from './TradeJournalTable';\nimport { PerformanceMetrics, Trade } from '@/lib/trading/analytics';\n\nexport default function AnalyticsDashboard() {\n    const [timeframe, setTimeframe] = useState('ALL');\n    const [metrics, setMetrics] = useState<PerformanceMetrics | null>(null);\n    const [trades, setTrades] = useState<Trade[]>([]);\n\n    // Pagination state for Journal\n    const [page, setPage] = useState(1);\n    const [totalPages, setTotalPages] = useState(1);\n    const [journalLoading, setJournalLoading] = useState(true);\n\n    const [isLoading, setIsLoading] = useState(true);\n\n    useEffect(() => {\n        fetchPerformanceData();\n        fetchJournalData();\n    }, [timeframe]);\n\n    useEffect(() => {\n        fetchJournalData();\n    }, [page]);\n\n    const fetchPerformanceData = async () => {\n        try {\n            const res = await fetch(`/api/analytics/performance?timeframe=${timeframe}`);\n            if (res.ok) {\n                const data = await res.json();\n                setMetrics(data);\n            }\n        } catch (error) {\n            console.error('Failed to fetch performance metrics', error);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const fetchJournalData = async () => {\n        setJournalLoading(true);\n        try {\n            const res = await fetch(`/api/analytics/journal?page=${page}&limit=10&timeframe=${timeframe}`);\n            if (res.ok) {\n                const data = await res.json();\n                setTrades(data.trades);\n                setTotalPages(data.pagination.pages);\n            }\n        } catch (error) {\n            console.error('Failed to fetch journal', error);\n        } finally {\n            setJournalLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div style={{\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                backgroundColor: 'rgba(13, 17, 23, 0.5)',\n                padding: '1rem',\n                borderRadius: '0.75rem',\n                border: '1px solid #30363d',\n                backdropFilter: 'blur(12px)'\n            }}>\n                <h2 className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-100 to-gray-400\">\n                    Portfolio Analytics\n                </h2>\n                <div style={{\n                    display: 'flex',\n                    backgroundColor: '#0d1117',\n                    borderRadius: '0.5rem',\n                    padding: '0.25rem',\n                    border: '1px solid #30363d'\n                }}>\n                    {['7D', '30D', '90D', 'YTD', 'ALL'].map(tf => (\n                        <button\n                            key={tf}\n                            onClick={() => setTimeframe(tf)}\n                            style={{\n                                padding: '0.375rem 1rem',\n                                fontSize: '0.875rem',\n                                fontWeight: 600,\n                                borderRadius: '0.375rem',\n                                transition: 'all 0.2s',\n                                color: timeframe === tf ? 'white' : '#6b7280',\n                                backgroundColor: timeframe === tf ? '#4f46e5' : 'transparent',\n                                boxShadow: timeframe === tf ? '0 1px 2px rgba(0,0,0,0.2)' : 'none'\n                            }}\n                        >\n                            {tf}\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            {isLoading ? (\n                <div className=\"animate-pulse space-y-4\">\n                    <div className=\"h-32 bg-gray-800 rounded-lg\"></div>\n                    <div className=\"h-96 bg-gray-800 rounded-lg\"></div>\n                </div>\n            ) : metrics ? (\n                <>\n                    <MetricsGrid metrics={metrics} />\n                    <EquityCurveChart equityCurve={metrics.equityCurve} />\n                </>\n            ) : (\n                <div className=\"text-center py-10 text-gray-500\">Failed to load analytics data.</div>\n            )}\n\n            <div className=\"mt-8\">\n                <h3 className=\"text-xl font-bold mb-4\">Trade Journal</h3>\n                <TradeJournalTable\n                    trades={trades}\n                    page={page}\n                    totalPages={totalPages}\n                    onPageChange={setPage}\n                    isLoading={journalLoading}\n                />\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/analytics/EquityCurveChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PerformanceMetrics' is defined but never used.","line":20,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"PerformanceMetrics"},"fix":{"range":[318,337],"text":""},"desc":"Remove unused variable \"PerformanceMetrics\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport React from 'react';\nimport {\n    Chart as ChartJS,\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    Title,\n    Tooltip,\n    Legend,\n    Filler,\n    ScriptableContext,\n    TooltipItem,\n    ChartOptions\n} from 'chart.js';\nimport { Line } from 'react-chartjs-2';\nimport { PerformanceMetrics, EquityPoint } from '@/lib/trading/analytics';\n\nChartJS.register(\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    Title,\n    Tooltip,\n    Legend,\n    Filler\n);\n\ninterface EquityCurveChartProps {\n    equityCurve: EquityPoint[];\n}\n\nexport default function EquityCurveChart({ equityCurve }: EquityCurveChartProps) {\n    // If no data, showing empty state\n    if (!equityCurve || equityCurve.length === 0) {\n        return (\n            <div style={{\n                backgroundColor: 'rgba(13, 17, 23, 0.5)',\n                padding: '1.5rem',\n                borderRadius: '0.75rem',\n                border: '1px solid #30363d',\n                height: '24rem',\n                display: 'flex',\n                flexDirection: 'column',\n                alignItems: 'center',\n                justifyContent: 'center',\n                color: '#6b7280',\n                gap: '1rem'\n            }}>\n                <div style={{\n                    padding: '1rem',\n                    backgroundColor: 'rgba(55, 65, 81, 0.2)',\n                    borderRadius: '50%',\n                    border: '1px solid rgba(75, 85, 99, 0.3)'\n                }}>\n                    {/* Using a simple SVG since LineChart import might not be available or compatible with chart.js imports above */}\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                        <path d=\"M3 3v18h18\" />\n                        <path d=\"m19 9-5 5-4-4-3 3\" />\n                    </svg>\n                </div>\n                <div className=\"text-center\">\n                    <p className=\"text-gray-400 font-medium mb-1\">No data yet</p>\n                    <p className=\"text-sm text-gray-500\">Start trading to see your performance equity curve.</p>\n                </div>\n            </div>\n        );\n    }\n\n    const data = {\n        labels: equityCurve.map(p => p.date),\n        datasets: [\n            {\n                label: 'Portfolio Equity',\n                data: equityCurve.map(p => p.equity),\n                borderColor: '#4f46e5', // Indigo\n                backgroundColor: (context: ScriptableContext<'line'>) => {\n                    const ctx = context.chart.ctx;\n                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);\n                    gradient.addColorStop(0, 'rgba(79, 70, 229, 0.2)');\n                    gradient.addColorStop(1, 'rgba(79, 70, 229, 0)');\n                    return gradient;\n                },\n                fill: true,\n                tension: 0.4,\n                pointRadius: 0,\n                pointHoverRadius: 4,\n                pointBackgroundColor: '#4f46e5',\n                borderWidth: 2\n            },\n        ],\n    };\n\n    const options = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n            legend: {\n                display: false,\n            },\n            tooltip: {\n                mode: 'index' as const,\n                intersect: false,\n                backgroundColor: 'rgba(17, 24, 39, 0.9)',\n                titleColor: '#e5e7eb',\n                bodyColor: '#e5e7eb',\n                borderColor: '#374151',\n                borderWidth: 1,\n                padding: 10,\n                displayColors: false,\n                callbacks: {\n                    label: function (context: TooltipItem<'line'>) {\n                        let label = context.dataset.label || '';\n                        if (label) {\n                            label += ': ';\n                        }\n                        if (context.parsed.y !== null) {\n                            label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);\n                        }\n                        return label;\n                    }\n                }\n            },\n        },\n        scales: {\n            x: {\n                grid: {\n                    display: false,\n                    drawBorder: false,\n                },\n                ticks: {\n                    color: '#6b7280',\n                    maxTicksLimit: 8,\n                    font: {\n                        size: 10\n                    }\n                }\n            },\n            y: {\n                grid: {\n                    color: 'rgba(55, 65, 81, 0.3)',\n                    borderDash: [5, 5],\n                    drawBorder: false,\n                },\n                ticks: {\n                    color: '#6b7280',\n                    font: {\n                        size: 10\n                    },\n                    callback: function (value: number | string) {\n                        const numericValue = typeof value === 'string' ? parseFloat(value) : value;\n                        return '$' + numericValue / 1000 + 'k';\n                    }\n                }\n            },\n        },\n        interaction: {\n            mode: 'nearest' as const,\n            axis: 'x' as const,\n            intersect: false\n        }\n    };\n\n    const typedOptions: ChartOptions<'line'> = options;\n\n    return (\n        <div style={{\n            backgroundColor: 'rgba(13, 17, 23, 0.5)',\n            padding: '1.5rem',\n            borderRadius: '0.75rem',\n            border: '1px solid #30363d',\n            height: '24rem',\n            marginTop: '1.5rem'\n        }}>\n            <h3 className=\"text-lg font-bold text-white mb-4 flex items-center gap-2\">\n                Equity Curve\n            </h3>\n            <div className=\"h-80\">\n                <Line options={typedOptions} data={data} key={equityCurve.length} />\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/analytics/MetricsGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/analytics/TradeJournalTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/auth/AuthGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/auth/AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/auth/UserMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[162,167],"text":""},"desc":"Remove unused variable \"User\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useSession, signOut } from 'next-auth/react';\nimport Link from 'next/link';\nimport { useState, useRef, useEffect } from 'react';\nimport { User, Settings, LogOut, ChevronDown, BarChart3, Briefcase, Shield, Star } from 'lucide-react';\n\nexport default function UserMenu() {\n    const { data: session, status } = useSession();\n    const [isOpen, setIsOpen] = useState(false);\n    const menuRef = useRef<HTMLDivElement>(null);\n\n    // Close menu when clicking outside\n    useEffect(() => {\n        function handleClickOutside(event: MouseEvent) {\n            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n                setIsOpen(false);\n            }\n        }\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    if (status === 'loading') {\n        return <div className=\"h-9 w-9 bg-gray-800 rounded-xl animate-pulse\"></div>;\n    }\n\n    if (status === 'unauthenticated') {\n        return null;\n    }\n\n    const initials = session?.user?.name\n        ?.split(' ')\n        .map(n => n[0])\n        .join('')\n        .toUpperCase()\n        .slice(0, 2) || 'U';\n\n    return (\n        <div className=\"relative\" ref={menuRef}>\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                aria-haspopup=\"true\"\n                aria-expanded={isOpen}\n                aria-label=\"User menu\"\n                className={`flex items-center gap-2.5 px-2 py-1.5 rounded-xl transition-all duration-200 border ${isOpen\n                    ? 'bg-gray-800/80 border-gray-700/60'\n                    : 'hover:bg-gray-800/50 border-transparent hover:border-gray-700/40'\n                    }`}\n            >\n                <div className=\"h-8 w-8 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-xs font-bold shadow-md shadow-blue-500/20\">\n                    {initials}\n                </div>\n                <span className=\"text-sm font-medium hidden md:block text-gray-200 max-w-[120px] truncate\">\n                    {session?.user?.name || 'User'}\n                </span>\n                <ChevronDown\n                    size={14}\n                    className={`text-gray-500 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`}\n                />\n            </button>\n\n            {isOpen && (\n                <>\n                    <style>{`\n                        .user-menu-dropdown {\n                            position: absolute;\n                            right: 0;\n                            margin-top: 0.5rem;\n                            width: 16rem;\n                            max-width: calc(100vw - 2rem);\n                            z-index: 50;\n                            overflow: hidden;\n                            background: #1c2129;\n                            border: 1px solid #3d444d;\n                            border-radius: 0.75rem;\n                            box-shadow: 0 8px 30px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.06);\n                        }\n                        @media (max-width: 480px) {\n                            .user-menu-dropdown {\n                                position: fixed;\n                                right: 0.5rem;\n                                top: 4rem;\n                                margin-top: 0;\n                            }\n                        }\n                    `}</style>\n                    <div\n                        className=\"user-menu-dropdown\"\n                        style={{ animation: 'menu-fade-in 0.15s ease-out' }}\n                    >\n                        {/* User info */}\n                        <div className=\"px-4 py-4 border-b border-gray-800/60\">\n                            <div className=\"flex items-center gap-3\">\n                                <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-sm font-bold shadow-md\">\n                                    {initials}\n                                </div>\n                                <div className=\"min-w-0 flex-1\">\n                                    <p className=\"text-sm font-semibold text-white truncate\">{session?.user?.name}</p>\n                                    <p className=\"text-xs text-gray-500 truncate\">{session?.user?.email}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Navigation */}\n                        <div\n                            style={{\n                                paddingTop: '0.375rem',\n                                paddingBottom: '0.375rem',\n                                paddingLeft: '0.375rem',\n                                fontSize: '1rem',\n                                paddingRight: '0.375rem'\n                            }}\n                        >\n                            {[\n                                { href: '/portfolio', icon: Briefcase, label: 'Portfolio', desc: 'Holdings & trades' },\n                                { href: '/watchlist', icon: Star, label: 'Watchlist', desc: 'Tracked assets' },\n                                { href: '/finance', icon: BarChart3, label: 'Finance', desc: 'Income, goals & health' },\n                                { href: '/analytics', icon: BarChart3, label: 'Analytics', desc: 'Performance metrics' },\n                                { href: '/settings', icon: Settings, label: 'Settings', desc: 'Account & preferences' },\n                                ...(['SUPER_ADMIN', 'MARKET_ADMIN', 'COMPLIANCE_OFFICER', 'SUPPORT_AGENT'].includes(session?.user?.role ?? '') ? [\n                                    { href: '/admin', icon: Shield, label: 'Admin', desc: 'Platform management' },\n                                ] : []),\n                            ].map((item) => (\n                                <Link\n                                    key={item.href}\n                                    href={item.href}\n                                    style={{\n                                        display: 'flex',\n                                        fontSize: '1rem',\n                                        alignItems: 'center',\n                                        gap: '0.75rem',\n                                        paddingLeft: '0.75rem',\n                                        paddingRight: '0.75rem',\n                                        paddingTop: '0.625rem',\n                                        paddingBottom: '0.625rem',\n                                        borderRadius: '0.5rem',\n                                        color: '#d1d5db',\n                                        transition: 'all 0.15s'\n                                    }}\n                                    onClick={() => setIsOpen(false)}\n                                    onMouseEnter={(e) => {\n                                        e.currentTarget.style.backgroundColor = 'rgba(255,255,255,0.05)';\n                                        e.currentTarget.style.color = 'white';\n                                    }}\n                                    onMouseLeave={(e) => {\n                                        e.currentTarget.style.backgroundColor = 'transparent';\n                                        e.currentTarget.style.color = '#d1d5db';\n                                    }}\n                                >\n                                    <div\n                                        style={{\n                                            width: '2rem',\n                                            height: '2rem',\n                                            borderRadius: '0.5rem',\n                                            backgroundColor: 'rgba(31,41,55,0.6)',\n                                            display: 'flex',\n                                            fontSize: '1rem',\n                                            alignItems: 'center',\n                                            justifyContent: 'center',\n                                            transition: 'all 0.15s'\n                                        }}\n                                        onMouseEnter={(e) => {\n                                            e.currentTarget.style.backgroundColor = 'rgba(55,65,81,0.6)';\n                                        }}\n                                        onMouseLeave={(e) => {\n                                            e.currentTarget.style.backgroundColor = 'rgba(31,41,55,0.6)';\n                                        }}\n                                    >\n                                        <item.icon\n                                            size={15}\n                                            style={{\n                                                color: '#9ca3af',\n                                                transition: 'color 0.15s'\n                                            }}\n                                            onMouseEnter={(e: React.MouseEvent<SVGSVGElement>) => {\n                                                e.currentTarget.style.color = 'white';\n                                            }}\n                                            onMouseLeave={(e: React.MouseEvent<SVGSVGElement>) => {\n                                                e.currentTarget.style.color = '#9ca3af';\n                                            }}\n                                        />\n                                    </div>\n                                    <div>\n                                        <p style={{\n                                            fontSize: '0.875rem',\n                                            fontWeight: '500',\n                                            lineHeight: '1',\n                                        }}>{item.label}</p>\n                                        <p style={{\n                                            fontSize: '0.6875rem',\n                                            color: '#9ca3af',\n                                            lineHeight: '1',\n                                            transition: 'color 0.15s'\n                                        }}\n                                            onMouseEnter={(e) => {\n                                                e.currentTarget.style.color = '#6b7280';\n                                            }}\n                                            onMouseLeave={(e) => {\n                                                e.currentTarget.style.color = '#9ca3af';\n                                            }}\n                                        >{item.desc}</p>\n                                    </div>\n                                </Link>\n                            ))}\n                        </div>\n\n                        {/* Sign out */}\n                        <div className=\"border-t border-gray-800/60 py-1.5 px-1.5\">\n                            <button\n                                onClick={() => signOut({ callbackUrl: '/' })}\n                                className=\"flex w-full items-center gap-3 px-3 py-2.5 rounded-lg text-gray-400 hover:bg-red-500/8 hover:text-red-400 transition-all duration-150 group\"\n                            >\n                                <div className=\"w-8 h-8 rounded-lg bg-gray-800/60 group-hover:bg-red-500/10 flex items-center justify-center transition-colors\">\n                                    <LogOut size={15} className=\"text-gray-500 group-hover:text-red-400 transition-colors\" />\n                                </div>\n                                <span className=\"text-sm font-medium\">Sign Out</span>\n                            </button>\n                        </div>\n                    </div>\n                </>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/settings/SecuritySettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Key' is defined but never used.","line":5,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Key"},"fix":{"range":[118,123],"text":""},"desc":"Remove unused variable \"Key\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { Shield, Smartphone, Key, AlertTriangle, CheckCircle2, Loader2, Copy } from 'lucide-react';\nimport { useRouter } from 'next/navigation';\n\ninterface User {\n    twoFactorEnabled: boolean;\n}\n\nexport default function SecuritySettings({ user }: { user: User }) {\n    const router = useRouter();\n    const [isEnabled, setIsEnabled] = useState(user.twoFactorEnabled);\n    const [step, setStep] = useState<'initial' | 'setup' | 'verify'>('initial');\n    const [secret, setSecret] = useState('');\n    const [otpauthUrl, setOtpauthUrl] = useState('');\n    const [verificationCode, setVerificationCode] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [successMessage, setSuccessMessage] = useState('');\n\n    const startSetup = async () => {\n        setLoading(true);\n        setError('');\n        try {\n            const res = await fetch('/api/auth/2fa/setup', { method: 'POST' });\n            const data = await res.json();\n            if (!res.ok) throw new Error(data.message);\n\n            setSecret(data.secret);\n            setOtpauthUrl(data.otpauthUrl);\n            setStep('setup');\n        } catch (err: unknown) {\n            const errorMessage = err instanceof Error ? err.message : 'Failed to start setup';\n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const verifyAndEnable = async () => {\n        setLoading(true);\n        setError('');\n        try {\n            const res = await fetch('/api/auth/2fa/verify', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ code: verificationCode }),\n            });\n            const data = await res.json();\n            if (!res.ok) throw new Error(data.message);\n\n            setIsEnabled(true);\n            setStep('initial');\n            setSuccessMessage('Two-factor authentication enabled successfully!');\n            router.refresh();\n\n            // Clear success message after 3 seconds\n            setTimeout(() => setSuccessMessage(''), 3000);\n        } catch (err: unknown) {\n            const errorMessage = err instanceof Error ? err.message : 'Verification failed';\n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const disable2FA = async () => {\n        if (!confirm('Are you sure you want to disable 2FA? Your account will be less secure.')) return;\n\n        setLoading(true);\n        try {\n            const res = await fetch('/api/auth/2fa/setup', { method: 'DELETE' });\n            if (!res.ok) throw new Error('Failed to disable 2FA');\n\n            setIsEnabled(false);\n            setSuccessMessage('Two-factor authentication disabled.');\n            router.refresh();\n            setTimeout(() => setSuccessMessage(''), 3000);\n        } catch (err: unknown) {\n            const errorMessage = err instanceof Error ? err.message : 'An error occurred';\n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const copyToClipboard = (text: string) => {\n        navigator.clipboard.writeText(text);\n        alert('Copied to clipboard!'); // Replace with toast if available\n    };\n\n    return (\n        <div className=\"card\">\n            <div className=\"flex justify-between items-start mb-6\">\n                <div className=\"flex gap-3\">\n                    <div className=\"p-2 rounded-lg bg-blue-500/10 text-blue-500\">\n                        <Shield size={24} />\n                    </div>\n                    <div>\n                        <h3 className=\"text-xl font-bold text-white\">Two-Factor Authentication</h3>\n                        <p className=\"text-slate-400 text-sm mt-1\">\n                            Add an extra layer of security to your account using TOTP apps like Google Authenticator or Authy.\n                        </p>\n                    </div>\n                </div>\n                {isEnabled && (\n                    <span className=\"px-3 py-1 rounded-full bg-green-500/10 text-green-500 text-xs font-semibold border border-green-500/20\">\n                        ENABLED\n                    </span>\n                )}\n            </div>\n\n            {error && (\n                <div className=\"p-4 mb-4 rounded-lg bg-red-500/10 border border-red-500/20 text-red-500 flex items-center gap-2 text-sm\">\n                    <AlertTriangle size={16} />\n                    {error}\n                </div>\n            )}\n\n            {successMessage && (\n                <div className=\"p-4 mb-4 rounded-lg bg-green-500/10 border border-green-500/20 text-green-500 flex items-center gap-2 text-sm\">\n                    <CheckCircle2 size={16} />\n                    {successMessage}\n                </div>\n            )}\n\n            {!isEnabled && step === 'initial' && (\n                <div className=\"bg-slate-800/50 rounded-xl p-6 border border-slate-700/50\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                            <Smartphone className=\"text-slate-400\" />\n                            <div>\n                                <h4 className=\"font-semibold text-slate-200\">Authenticator App</h4>\n                                <p className=\"text-sm text-slate-500\">Use an app to generate verification codes.</p>\n                            </div>\n                        </div>\n                        <button\n                            onClick={startSetup}\n                            disabled={loading}\n                            className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2\"\n                        >\n                            {loading ? <Loader2 className=\"animate-spin\" size={16} /> : 'Enable 2FA'}\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {step === 'setup' && (\n                <div className=\"space-y-6 animate-fade-in\">\n                    <div className=\"grid md:grid-cols-2 gap-8\">\n                        {/* QR Code Section */}\n                        <div className=\"bg-white p-4 rounded-xl w-fit mx-auto md:mx-0\">\n                            <QRCodeSVG value={otpauthUrl} size={180} />\n                        </div>\n\n                        {/* Manual Entry Section */}\n                        <div className=\"space-y-4\">\n                            <div>\n                                <h4 className=\"font-semibold text-white mb-2\">1. Scan QR Code</h4>\n                                <p className=\"text-sm text-slate-400\">\n                                    Open your authenticator app (Google Authenticator, Authy, etc.) and scan the QR code.\n                                </p>\n                            </div>\n\n                            <div className=\"p-3 bg-slate-900 rounded-lg border border-slate-700\">\n                                <p className=\"text-xs text-slate-500 mb-1 uppercase font-semibold\">Manual Entry Key</p>\n                                <div className=\"flex items-center justify-between text-slate-300 font-mono text-sm\">\n                                    <span>{secret}</span>\n                                    <button\n                                        onClick={() => copyToClipboard(secret)}\n                                        className=\"p-1 hover:text-white transition-colors\"\n                                        title=\"Copy to clipboard\"\n                                    >\n                                        <Copy size={14} />\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div>\n                                <h4 className=\"font-semibold text-white mb-2\">2. Enter Verification Code</h4>\n                                <div className=\"flex gap-2\">\n                                    <input\n                                        type=\"text\"\n                                        value={verificationCode}\n                                        onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                                        placeholder=\"000 000\"\n                                        className=\"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white font-mono tracking-widest w-40 focus:ring-2 focus:ring-blue-500 outline-none\"\n                                    />\n                                    <button\n                                        onClick={verifyAndEnable}\n                                        disabled={loading || verificationCode.length !== 6}\n                                        className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n                                    >\n                                        {loading ? <Loader2 className=\"animate-spin\" size={16} /> : 'Verify & Enable'}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <button\n                        onClick={() => setStep('initial')}\n                        className=\"text-slate-500 hover:text-slate-300 text-sm\"\n                    >\n                        Cancel Setup\n                    </button>\n                </div>\n            )}\n\n            {isEnabled && (\n                <div className=\"bg-red-500/5 rounded-xl p-6 border border-red-500/10 mt-6\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <h4 className=\"font-semibold text-red-400\">Disable Two-Factor Authentication</h4>\n                            <p className=\"text-sm text-red-500/70 mt-1\">\n                                Removes the extra layer of security from your account.\n                            </p>\n                        </div>\n                        <button\n                            onClick={disable2FA}\n                            disabled={loading}\n                            className=\"px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 rounded-lg font-medium transition-colors disabled:opacity-50\"\n                        >\n                            Disable\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/ui/Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/components/ui/Toast.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'timersRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'timersRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":69,"column":23,"nodeType":"Identifier","endLine":69,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { createContext, useContext, useState, useCallback, useRef, useEffect, ReactNode } from 'react';\nimport { X, CheckCircle, AlertCircle, Info, AlertTriangle } from 'lucide-react';\n\ntype ToastType = 'success' | 'error' | 'info' | 'warning';\n\ninterface Toast {\n    id: string;\n    message: string;\n    type: ToastType;\n    duration?: number;\n}\n\ninterface ToastContextType {\n    toast: (message: string, type?: ToastType, duration?: number) => void;\n    success: (message: string) => void;\n    error: (message: string) => void;\n    info: (message: string) => void;\n    warning: (message: string) => void;\n}\n\nconst ToastContext = createContext<ToastContextType | undefined>(undefined);\n\nexport function useToast() {\n    const ctx = useContext(ToastContext);\n    if (!ctx) throw new Error('useToast must be used within ToastProvider');\n    return ctx;\n}\n\nconst TOAST_ICONS = {\n    success: CheckCircle,\n    error: AlertCircle,\n    info: Info,\n    warning: AlertTriangle,\n};\n\nconst TOAST_COLORS = {\n    success: { bg: 'rgba(34, 197, 94, 0.15)', border: 'rgba(34, 197, 94, 0.3)', icon: '#4ade80' },\n    error: { bg: 'rgba(239, 68, 68, 0.15)', border: 'rgba(239, 68, 68, 0.3)', icon: '#f87171' },\n    info: { bg: 'rgba(59, 130, 246, 0.15)', border: 'rgba(59, 130, 246, 0.3)', icon: '#60a5fa' },\n    warning: { bg: 'rgba(234, 179, 8, 0.15)', border: 'rgba(234, 179, 8, 0.3)', icon: '#fbbf24' },\n};\n\nexport function ToastProvider({ children }: { children: ReactNode }) {\n    const [toasts, setToasts] = useState<Toast[]>([]);\n    const timersRef = useRef<Map<string, NodeJS.Timeout>>(new Map());\n\n    const removeToast = useCallback((id: string) => {\n        setToasts(prev => prev.filter(t => t.id !== id));\n        const timer = timersRef.current.get(id);\n        if (timer) {\n            clearTimeout(timer);\n            timersRef.current.delete(id);\n        }\n    }, []);\n\n    const addToast = useCallback((message: string, type: ToastType = 'info', duration = 4000) => {\n        const id = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\n        setToasts(prev => [...prev.slice(-4), { id, message, type, duration }]); // Max 5 toasts\n\n        const timer = setTimeout(() => removeToast(id), duration);\n        timersRef.current.set(id, timer);\n    }, [removeToast]);\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            timersRef.current.forEach(timer => clearTimeout(timer));\n        };\n    }, []);\n\n    const ctx: ToastContextType = {\n        toast: addToast,\n        success: (msg) => addToast(msg, 'success'),\n        error: (msg) => addToast(msg, 'error'),\n        info: (msg) => addToast(msg, 'info'),\n        warning: (msg) => addToast(msg, 'warning'),\n    };\n\n    return (\n        <ToastContext.Provider value={ctx}>\n            {children}\n            {/* Toast Container */}\n            <div\n                style={{\n                    position: 'fixed',\n                    bottom: '1.5rem',\n                    right: '1.5rem',\n                    zIndex: 9999,\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '0.5rem',\n                    pointerEvents: 'none',\n                }}\n            >\n                {toasts.map((t) => {\n                    const Icon = TOAST_ICONS[t.type];\n                    const colors = TOAST_COLORS[t.type];\n                    return (\n                        <div\n                            key={t.id}\n                            style={{\n                                display: 'flex',\n                                alignItems: 'center',\n                                gap: '0.75rem',\n                                padding: '0.875rem 1rem',\n                                background: colors.bg,\n                                border: `1px solid ${colors.border}`,\n                                borderRadius: '0.75rem',\n                                backdropFilter: 'blur(12px)',\n                                WebkitBackdropFilter: 'blur(12px)',\n                                minWidth: '300px',\n                                maxWidth: '420px',\n                                animation: 'toast-slide-in 0.3s ease-out',\n                                pointerEvents: 'auto',\n                                boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.5)',\n                            }}\n                        >\n                            <Icon style={{ width: '1.125rem', height: '1.125rem', color: colors.icon, flexShrink: 0 }} />\n                            <span style={{ flex: 1, fontSize: '0.875rem', color: '#e5e7eb', fontWeight: 500 }}>\n                                {t.message}\n                            </span>\n                            <button\n                                onClick={() => removeToast(t.id)}\n                                style={{\n                                    background: 'none',\n                                    border: 'none',\n                                    color: '#6b7280',\n                                    cursor: 'pointer',\n                                    padding: '0.25rem',\n                                    display: 'flex',\n                                    flexShrink: 0,\n                                }}\n                            >\n                                <X style={{ width: '0.875rem', height: '0.875rem' }} />\n                            </button>\n                        </div>\n                    );\n                })}\n            </div>\n        </ToastContext.Provider>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/context/MarketContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/context/ThemeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useAccount.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useAccount.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useAdvisor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useBankAccounts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useBudgets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useChat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useFinancialHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useGoals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useKeyboardShortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useMarketData.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react/display-name').","line":5,"column":1,"severity":1,"nodeType":null,"fix":{"range":[138,177],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { renderHook, waitFor } from '@testing-library/react';\nimport { useMarketData } from '@/hooks/useMarketData';\n\n// Mock the context\n/* eslint-disable react/display-name */\njest.mock('@/context/MarketContext', () => ({\n    useMarket: () => ({ country: 'US' })\n}));\n\ndescribe('useMarketData Hook', () => {\n    let originalFetch: typeof global.fetch;\n\n    beforeEach(() => {\n        jest.clearAllMocks();\n        originalFetch = global.fetch;\n        global.fetch = jest.fn();\n    });\n\n    afterEach(() => {\n        global.fetch = originalFetch;\n    });\n\n    it('should fetch market data successfully', async () => {\n        const mockData = {\n            quote: { c: 150.25 },\n            history: { c: [150, 151] }\n        };\n\n        (global.fetch as jest.Mock).mockResolvedValueOnce({\n            json: async () => mockData,\n            ok: true\n        });\n\n        const { result } = renderHook(() => useMarketData('AAPL', 'stock'));\n\n        await waitFor(() => {\n            expect(result.current.data).toEqual(mockData);\n            expect(result.current.loading).toBe(false);\n        });\n\n        expect(global.fetch).toHaveBeenCalledWith(expect.stringContaining('/api/market-data?symbol=AAPL&assetClass=stock'));\n    });\n\n    it('should handle fetch errors', async () => {\n        const errorMsg = 'API Error';\n        (global.fetch as jest.Mock).mockRejectedValueOnce(new Error(errorMsg));\n\n        const { result } = renderHook(() => useMarketData('AAPL', 'stock'));\n\n        await waitFor(() => {\n            if (result.current.loading) {\n                return; // Let waitFor retry\n            }\n            // If loading is false, check for error\n            if (!result.current.error) {\n                throw new Error('Expected error but got none');\n            }\n            expect(result.current.error).toBe(errorMsg);\n        });\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useMarketData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useOrders.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used.","line":1,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"waitFor"},"fix":{"range":[19,28],"text":""},"desc":"Remove unused variable \"waitFor\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, waitFor } from '@testing-library/react';\nimport { useOrders } from '@/hooks/useOrders';\n\nglobal.fetch = jest.fn();\n\ndescribe('useOrders Hook', () => {\n    beforeEach(() => {\n        jest.clearAllMocks();\n    });\n\n    it('should submit an order successfully', async () => {\n        const mockResponse = {\n            success: true,\n            data: {\n                message: 'Order placed',\n                order: { id: '123', status: 'new' }\n            }\n        };\n\n        (global.fetch as jest.Mock).mockResolvedValueOnce({\n            json: async () => mockResponse,\n            ok: true\n        });\n\n        const { result } = renderHook(() => useOrders());\n\n        const orderData = {\n            symbol: 'AAPL',\n            qty: 10,\n            side: 'buy' as const,\n            type: 'market' as const,\n            time_in_force: 'gtc' as const\n        };\n\n        const response = await result.current.submitOrder(orderData);\n\n        expect(response.success).toBe(true);\n        expect(response.message).toBe('Order placed');\n        expect(result.current.lastOrder).toEqual(mockResponse.data.order);\n        expect(global.fetch).toHaveBeenCalledWith('/api/trading/orders', expect.objectContaining({\n            method: 'POST',\n            body: JSON.stringify(orderData)\n        }));\n    });\n\n    it('should handle order submission failure', async () => {\n        const mockErrorResponse = {\n            success: false,\n            error: 'Insufficent funds'\n        };\n\n        (global.fetch as jest.Mock).mockResolvedValueOnce({\n            json: async () => mockErrorResponse,\n            ok: false\n        });\n\n        const { result } = renderHook(() => useOrders());\n\n        const response = await result.current.submitOrder({\n            symbol: 'AAPL',\n            qty: 1000,\n            side: 'buy',\n            type: 'market',\n            time_in_force: 'gtc'\n        });\n\n        expect(response.success).toBe(false);\n        expect(response.error).toBe('Insufficent funds');\n        expect(result.current.lastOrder).toBeNull();\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useOrders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useTransactions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/hooks/useWatchlist.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/instrumentation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/ai/gemini.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/api-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/audit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/auth/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/auth/credentials.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/auth/encryption.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/auth/roles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/brokers/alpaca.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/brokers/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/countries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/currencies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/db/prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/encryption.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/exchanges.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'priorities' is assigned a value but never used.","line":18,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const EXCHANGE_PRIORITY: Record<string, string[]> = {\n    'US': ['NYSE', 'NASDAQ'],\n    'GB': ['LSE'],\n    'DE': ['XETRA', 'FRA'],\n    'FR': ['Euronext Paris'],\n    'JP': ['JPX'],\n    'CA': ['TSX'],\n    'IN': ['NSE', 'BSE'],\n    // Add more mappings\n};\n\nexport function getPriorityExchanges(countryCode: string): string[] {\n    return EXCHANGE_PRIORITY[countryCode] || ['US']; // Default to US if unknown\n}\n\nexport function formatSymbolForCountry(symbol: string, countryCode: string): string {\n    // Logic to append exchange suffix if needed based on country priority\n    const priorities = getPriorityExchanges(countryCode);\n    if (countryCode === 'GB' && !symbol.includes('.')) {\n        return `${symbol}.L`;\n    }\n    if (countryCode === 'DE' && !symbol.includes('.')) {\n        return `${symbol}.DE`;\n    }\n    return symbol;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/indicators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/offers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ensureCount' is assigned a value but never used.","line":119,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface FeaturedAsset {\n    symbol: string;\n    name: string;\n    assetClass: 'stock' | 'crypto' | 'forex';\n}\n\nconst GLOBAL_STOCKS: FeaturedAsset[] = [\n    { symbol: 'AAPL', name: 'Apple Inc.', assetClass: 'stock' },\n    { symbol: 'MSFT', name: 'Microsoft Corp.', assetClass: 'stock' },\n    { symbol: 'GOOGL', name: 'Alphabet Inc.', assetClass: 'stock' },\n    { symbol: 'TSLA', name: 'Tesla Inc.', assetClass: 'stock' },\n    { symbol: 'NVDA', name: 'Nvidia', assetClass: 'stock' },\n    { symbol: 'AMZN', name: 'Amazon', assetClass: 'stock' },\n    { symbol: 'META', name: 'Meta Platforms', assetClass: 'stock' },\n    { symbol: 'NFLX', name: 'Netflix', assetClass: 'stock' },\n    { symbol: 'DIS', name: 'Walt Disney', assetClass: 'stock' },\n    { symbol: 'PYPL', name: 'PayPal', assetClass: 'stock' },\n];\n\nconst GLOBAL_CRYPTO: FeaturedAsset[] = [\n    { symbol: 'BTC/USD', name: 'Bitcoin', assetClass: 'crypto' },\n    { symbol: 'ETH/USD', name: 'Ethereum', assetClass: 'crypto' },\n    { symbol: 'SOL/USD', name: 'Solana', assetClass: 'crypto' },\n    { symbol: 'XRP/USD', name: 'Ripple', assetClass: 'crypto' },\n    { symbol: 'ADA/USD', name: 'Cardano', assetClass: 'crypto' },\n    { symbol: 'DOGE/USD', name: 'Dogecoin', assetClass: 'crypto' },\n];\n\nconst GLOBAL_FOREX: FeaturedAsset[] = [\n    { symbol: 'EUR/USD', name: 'Euro / US Dollar', assetClass: 'forex' },\n    { symbol: 'GBP/USD', name: 'British Pound', assetClass: 'forex' },\n    { symbol: 'USD/JPY', name: 'US Dollar / Yen', assetClass: 'forex' },\n    { symbol: 'AUD/USD', name: 'Australian Dollar', assetClass: 'forex' },\n    { symbol: 'USD/CAD', name: 'US Dollar / Canadian Dollar', assetClass: 'forex' },\n    { symbol: 'USD/CHF', name: 'US Dollar / Swiss Franc', assetClass: 'forex' },\n];\n\nexport const REGIONAL_OFFERS: Record<string, FeaturedAsset[]> = {\n    'US': [\n        { symbol: 'AAPL', name: 'Apple Inc.', assetClass: 'stock' },\n        { symbol: 'NVDA', name: 'Nvidia', assetClass: 'stock' },\n        { symbol: 'AMZN', name: 'Amazon', assetClass: 'stock' },\n    ],\n    'GB': [\n        { symbol: 'VOD', name: 'Vodafone Group', assetClass: 'stock' },\n        { symbol: 'HSBA', name: 'HSBC Holdings', assetClass: 'stock' },\n        { symbol: 'BP', name: 'BP PLC', assetClass: 'stock' },\n        { symbol: 'GBP/USD', name: 'British Pound', assetClass: 'forex' },\n    ],\n    'DE': [\n        { symbol: 'SAP', name: 'SAP SE', assetClass: 'stock' },\n        { symbol: 'DBK', name: 'Deutsche Bank', assetClass: 'stock' },\n        { symbol: 'BMW', name: 'BMW Group', assetClass: 'stock' },\n        { symbol: 'EUR/USD', name: 'Euro', assetClass: 'forex' },\n    ],\n    'IN': [\n        { symbol: 'RELIANCE', name: 'Reliance Industries', assetClass: 'stock' },\n        { symbol: 'TCS', name: 'Tata Consultancy', assetClass: 'stock' },\n        { symbol: 'HDFCBANK', name: 'HDFC Bank', assetClass: 'stock' },\n    ],\n    'CN': [\n        { symbol: 'BABA', name: 'Alibaba Group', assetClass: 'stock' },\n        { symbol: 'TCEHY', name: 'Tencent Holdings', assetClass: 'stock' },\n        { symbol: 'JD', name: 'JD.com', assetClass: 'stock' },\n    ],\n    'JP': [\n        { symbol: '7203', name: 'Toyota Motor', assetClass: 'stock' },\n        { symbol: '6758', name: 'Sony Group', assetClass: 'stock' },\n        { symbol: '9984', name: 'SoftBank Group', assetClass: 'stock' },\n        { symbol: 'USD/JPY', name: 'US Dollar / Yen', assetClass: 'forex' },\n    ],\n    'FR': [\n        { symbol: 'MC', name: 'LVMH', assetClass: 'stock' },\n        { symbol: 'OR', name: 'L\\'oreal', assetClass: 'stock' },\n        { symbol: 'TTE', name: 'TotalEnergies', assetClass: 'stock' },\n    ],\n    'BR': [\n        { symbol: 'VALE', name: 'Vale SA', assetClass: 'stock' },\n        { symbol: 'PBR', name: 'Petrobras', assetClass: 'stock' },\n        { symbol: 'ITUB', name: 'Itau Unibanco', assetClass: 'stock' },\n    ],\n    'AU': [\n        { symbol: 'CBA', name: 'Commonwealth Bank', assetClass: 'stock' },\n        { symbol: 'BHP', name: 'BHP Group', assetClass: 'stock' },\n        { symbol: 'AUD/USD', name: 'Australian Dollar', assetClass: 'forex' },\n    ],\n};\n\nfunction getStringHash(str: string): number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) - hash + str.charCodeAt(i);\n        hash |= 0;\n    }\n    return Math.abs(hash);\n}\n\nexport function getFeaturedAssets(countryCode: string): FeaturedAsset[] {\n    const regional = REGIONAL_OFFERS[countryCode] || [];\n    const hash = getStringHash(countryCode);\n\n    const combined = [...regional];\n    const seenSymbols = new Set(regional.map(a => a.symbol));\n\n    const addFromList = (list: FeaturedAsset[], count: number) => {\n        const available = list.filter(a => !seenSymbols.has(a.symbol));\n        // Use the hash to pick a starting index\n        const startIdx = hash % Math.max(1, available.length);\n        for (let i = 0; i < count && i < available.length; i++) {\n            const asset = available[(startIdx + i) % available.length];\n            if (asset) {\n                combined.push(asset);\n                seenSymbols.add(asset.symbol);\n            }\n        }\n    };\n\n    // Helper to ensure we get exactly target count\n    const ensureCount = (categoryAssets: FeaturedAsset[], globalSource: FeaturedAsset[], target: number) => {\n        const currentCount = combined.filter(a => a.assetClass === categoryAssets[0]?.assetClass).length;\n        const needed = target - currentCount;\n\n        if (needed > 0) {\n            addFromList(globalSource, needed);\n        }\n    };\n\n    // First ensure we have the regional ones added (already done via [...regional])\n\n    // Now fill up to 6 for each category\n    // Note: We need to filter combined to check current counts because regional might have mixed types\n\n    const currentStocks = combined.filter(a => a.assetClass === 'stock').length;\n    addFromList(GLOBAL_STOCKS, 6 - currentStocks);\n\n    const currentCrypto = combined.filter(a => a.assetClass === 'crypto').length;\n    addFromList(GLOBAL_CRYPTO, 6 - currentCrypto);\n\n    const currentForex = combined.filter(a => a.assetClass === 'forex').length;\n    addFromList(GLOBAL_FOREX, 6 - currentForex);\n\n    return combined;\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/aggregator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":126,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":126,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":154,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MarketDataProvider, MarketQuote, HistoricalBar, AssetClass } from './types';\nimport { FinnhubAdapter } from './finnhub';\nimport { TwelveDataAdapter } from './twelvedata';\nimport { FMPAdapter } from './fmp';\nimport { EODHDAdapter } from './eodhd';\nimport { getCachedData, setCachedData } from '../redis';\nimport { formatSymbolForCountry } from '../exchanges';\nimport logger from '../logger';\n\n/** Per-provider request timeout in milliseconds */\nconst PROVIDER_TIMEOUT_MS = 5000;\n\n/** Race a promise against a timeout. Rejects with TimeoutError if exceeded. */\nfunction withTimeout<T>(promise: Promise<T>, ms: number, label: string): Promise<T> {\n    return Promise.race([\n        promise,\n        new Promise<T>((_, reject) =>\n            setTimeout(() => reject(new Error(`Timeout: ${label} exceeded ${ms}ms`)), ms)\n        ),\n    ]);\n}\n\nexport interface MarketDataConfig {\n    fmp?: string;\n    finnhub?: string;\n    eodhd?: string;\n    twelveData?: string;\n}\n\nexport class MarketDataAggregator {\n    private providers: MarketDataProvider[];\n\n    constructor(config?: MarketDataConfig) {\n        this.providers = [];\n\n        const finnhubKey = config?.finnhub || process.env.FINNHUB_API_KEY;\n        const twelveDataKey = config?.twelveData || process.env.TWELVE_DATA_API_KEY;\n        const fmpKey = config?.fmp || process.env.FMP_API_KEY;\n        const eodhdKey = config?.eodhd || process.env.EODHD_API_KEY;\n\n        if (finnhubKey) {\n            this.providers.push(new FinnhubAdapter(finnhubKey));\n        }\n        if (twelveDataKey) {\n            this.providers.push(new TwelveDataAdapter(twelveDataKey));\n        }\n        if (fmpKey) {\n            this.providers.push(new FMPAdapter(fmpKey));\n        }\n        if (eodhdKey) {\n            this.providers.push(new EODHDAdapter(eodhdKey));\n        }\n\n        if (this.providers.length === 0) {\n            logger.warn('No market data providers configured. Using mock data.');\n        }\n    }\n\n    private getMockQuote(symbol: string, assetClass: AssetClass): MarketQuote {\n        return {\n            symbol,\n            price: 100 + Math.random() * 50,\n            change: Math.random() * 5 - 2.5,\n            changePercent: Math.random() * 2 - 1,\n            high: 160,\n            low: 140,\n            open: 150,\n            previousClose: 149,\n            timestamp: Date.now(),\n            assetClass,\n            provider: 'Mock'\n        };\n    }\n\n    private getMockHistory(limit: number, interval: string = '1d'): HistoricalBar[] {\n        const intervalMsMap: Record<string, number> = {\n            '5': 300000,\n            '15': 900000,\n            '30': 1800000,\n            '60': 3600000,\n            '240': 14400000,\n            'D': 86400000,\n            'W': 604800000,\n            'M': 2592000000,\n            '5m': 300000,\n            '15m': 900000,\n            '1h': 3600000,\n            '4h': 14400000,\n            '1d': 86400000,\n            '1w': 604800000,\n            '1mo': 2592000000,\n        };\n        const step = intervalMsMap[interval] || 86400000;\n\n        return Array.from({ length: limit }).map((_, i) => ({\n            time: Date.now() - (limit - i) * step,\n            open: 150 + Math.random() * 10,\n            high: 165 + Math.random() * 5,\n            low: 145 - Math.random() * 5,\n            close: 155 + Math.random() * 10,\n            volume: 1000000 + Math.random() * 500000\n        }));\n    }\n\n    async getQuote(symbol: string, assetClass: AssetClass, countryCode?: string): Promise<MarketQuote> {\n        const formattedSymbol = countryCode ? formatSymbolForCountry(symbol, countryCode) : symbol;\n\n        if (this.providers.length === 0) {\n            return this.getMockQuote(formattedSymbol, assetClass);\n        }\n        const cacheKey = `quote:${formattedSymbol}`;\n        const cached = await getCachedData<MarketQuote>(cacheKey);\n        if (cached) return cached;\n\n        for (const provider of this.providers) {\n            try {\n                const quote = await withTimeout(\n                    provider.getQuote(formattedSymbol, assetClass),\n                    PROVIDER_TIMEOUT_MS,\n                    `${provider.name}.getQuote(${formattedSymbol})`\n                );\n                if (quote) {\n                    await setCachedData(cacheKey, quote, 10);\n                    return quote;\n                }\n            } catch (err) {\n                logger.warn(`Provider ${provider.name} failed for ${formattedSymbol}, trying next...`);\n            }\n        }\n        return this.getMockQuote(formattedSymbol, assetClass);\n    }\n\n    async getHistory(symbol: string, assetClass: AssetClass, interval: string = '1d', limit: number = 30, countryCode?: string): Promise<HistoricalBar[]> {\n        const formattedSymbol = countryCode ? formatSymbolForCountry(symbol, countryCode) : symbol;\n\n        if (this.providers.length === 0) {\n            return this.getMockHistory(limit, interval);\n        }\n        const cacheKey = `history:${formattedSymbol}:${interval}:${limit}`;\n        const cached = await getCachedData<HistoricalBar[]>(cacheKey);\n        if (cached) return cached;\n\n        for (const provider of this.providers) {\n            try {\n                const history = await withTimeout(\n                    provider.getHistory(formattedSymbol, assetClass, interval, limit),\n                    PROVIDER_TIMEOUT_MS,\n                    `${provider.name}.getHistory(${formattedSymbol})`\n                );\n                if (history && history.length > 0) {\n                    await setCachedData(cacheKey, history, 3600);\n                    return history;\n                }\n            } catch (err) {\n                logger.warn(`Provider ${provider.name} history failed for ${formattedSymbol}, trying next...`);\n            }\n        }\n\n        return this.getMockHistory(limit, interval);\n    }\n}\n\nexport const marketData = new MarketDataAggregator();\n","usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/eodhd.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/finnhub.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/fmp.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/twelvedata.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/providers/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/redis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/services/geo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/stackedEdge.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/stripe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/subscription.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/trading/OrderMonitorService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/trading/analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/trading/risk.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/lib/ws.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/src/types/next-auth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/test/finnhub.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/mathu/projects/markets/test/logic.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]